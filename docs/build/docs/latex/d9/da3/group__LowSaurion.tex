\hypertarget{group__LowSaurion}{}\doxysection{Low\+Saurion}
\label{group__LowSaurion}\index{LowSaurion@{LowSaurion}}


The {\ttfamily saurion} class is designed to efficiently handle asynchronous input/output events on Linux systems using the {\ttfamily io\+\_\+uring} API. Its main purpose is to manage network operations such as socket connections, reads, writes, and closures by leveraging an event-\/driven model that enhances performance and scalability in highly concurrent applications.  


\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structsaurion}{saurion}}
\begin{DoxyCompactList}\small\item\em Main structure for managing io\+\_\+uring and socket events. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{group__LowSaurion_ga7889939b2b6cdf65275305251f749af0}{PACKING\+\_\+\+SZ}}~128
\begin{DoxyCompactList}\small\item\em Defines the memory alignment size for structures in the {\ttfamily saurion} class. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{group__LowSaurion_ga4a0bc8233ca030e29b9b94aed0177392}{EXTERNAL\+\_\+set\+\_\+socket}} (int p)
\item 
struct \mbox{\hyperlink{structsaurion}{saurion}} $\ast$ \mbox{\hyperlink{group__LowSaurion_gae589ab08ed623ad2ab6d13beec33b131}{saurion\+\_\+create}} (uint32\+\_\+t \mbox{\hyperlink{low__saurion_8h_a7001c0d6b3bf1fa114a0d230c6190e3d}{n\+\_\+threads}})
\begin{DoxyCompactList}\small\item\em Creates an instance of the {\ttfamily saurion} structure. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{group__LowSaurion_gaeeab8302b41112175566881a1b7bf905}{saurion\+\_\+start}} (struct \mbox{\hyperlink{structsaurion}{saurion}} $\ast$s)
\begin{DoxyCompactList}\small\item\em Starts event processing in the {\ttfamily saurion} structure. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__LowSaurion_ga9f32b41ec23178c2a693fec057b96532}{saurion\+\_\+stop}} (const struct \mbox{\hyperlink{structsaurion}{saurion}} $\ast$s)
\begin{DoxyCompactList}\small\item\em Stops event processing in the {\ttfamily saurion} structure. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__LowSaurion_ga7893ccf90a98845d5d95ffda0260d0b8}{saurion\+\_\+destroy}} (struct \mbox{\hyperlink{structsaurion}{saurion}} $\ast$s)
\begin{DoxyCompactList}\small\item\em Destroys the {\ttfamily saurion} structure and frees all associated resources. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__LowSaurion_gadd63cf225e55bcf4cd22ddcbd9d1c9b7}{saurion\+\_\+send}} (struct \mbox{\hyperlink{structsaurion}{saurion}} $\ast$s, const int fd, const char $\ast$const msg)
\begin{DoxyCompactList}\small\item\em Sends a message through a socket using io\+\_\+uring. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{group__LowSaurion_ga1c329b9155a9159b696b60247c9b328b}{allocate\+\_\+iovec}} (struct iovec $\ast$iov, size\+\_\+t amount, size\+\_\+t pos, size\+\_\+t size, void $\ast$$\ast$chd\+\_\+ptr)
\item 
int \mbox{\hyperlink{group__LowSaurion_gae64e81c0ce5f52d51684d8f1129e6076}{initialize\+\_\+iovec}} (struct iovec $\ast$iov, size\+\_\+t amount, size\+\_\+t pos, const void $\ast$msg, size\+\_\+t size, uint8\+\_\+t h)
\begin{DoxyCompactList}\small\item\em Initializes a specified {\ttfamily iovec} structure with a message fragment. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{group__LowSaurion_gaddb696f3c38e160dde5a5de6e6e10f70}{set\+\_\+request}} (struct \mbox{\hyperlink{structrequest}{request}} $\ast$$\ast$r, struct \mbox{\hyperlink{structNode}{Node}} $\ast$$\ast$l, size\+\_\+t s, const void $\ast$m, uint8\+\_\+t h)
\begin{DoxyCompactList}\small\item\em Sets up a request and allocates iovec structures for data handling in liburing. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{group__LowSaurion_gaec24df6ee2f4999bf64acf5fc42ed019}{read\+\_\+chunk}} (void $\ast$$\ast$dest, size\+\_\+t $\ast$len, struct \mbox{\hyperlink{structrequest}{request}} $\ast$const req)
\begin{DoxyCompactList}\small\item\em Reads a message chunk from the request\textquotesingle{}s iovec buffers, handling messages that may span multiple iovec entries. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__LowSaurion_ga0f9760bc800b946244ccf790081e6bb3}{free\+\_\+request}} (struct \mbox{\hyperlink{structrequest}{request}} $\ast$req, void $\ast$$\ast$children\+\_\+ptr, size\+\_\+t amount)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
The {\ttfamily saurion} class is designed to efficiently handle asynchronous input/output events on Linux systems using the {\ttfamily io\+\_\+uring} API. Its main purpose is to manage network operations such as socket connections, reads, writes, and closures by leveraging an event-\/driven model that enhances performance and scalability in highly concurrent applications. 

This function allocates memory for each {\ttfamily struct iovec}

The main structure, {\ttfamily saurion}, encapsulates {\ttfamily io\+\_\+uring} rings and facilitates synchronization between multiple threads through the use of mutexes and a thread pool that distributes operations in parallel. This allows efficient handling of I/O operations across several sockets simultaneously, without blocking threads during operations.

The messages are composed of three main parts\+:
\begin{DoxyItemize}
\item A header, which is an unsigned 64-\/bit number representing the length of the message body.
\item A body, which contains the actual message data.
\item A footer, which consists of 8 bits set to 0.
\end{DoxyItemize}

For example, for a message with 9000 bytes of content, the header would contain the number 9000, the body would consist of those 9000 bytes, and the footer would be 1 byte set to 0.

When these messages are sent to the kernel, they are divided into chunks using {\ttfamily iovec}. Each chunk can hold a maximum of 8192 bytes and contains two fields\+:
\begin{DoxyItemize}
\item {\ttfamily iov\+\_\+base}, which is an array where the chunk of the message is stored.
\item {\ttfamily iov\+\_\+len}, the number of bytes used in the {\ttfamily iov\+\_\+base} array.
\end{DoxyItemize}

For the message with 9000 bytes, the {\ttfamily iovec} division would look like this\+:


\begin{DoxyItemize}
\item The first {\ttfamily iovec} would contain\+:
\begin{DoxyItemize}
\item 8 bytes for the header (the length of the message body, 9000).
\item 8184 bytes of the message body.
\item {\ttfamily iov\+\_\+len} would be 8192 bytes in total.
\end{DoxyItemize}
\item The second {\ttfamily iovec} would contain\+:
\begin{DoxyItemize}
\item The remaining 816 bytes of the message body.
\item 1 byte for the footer (set to 0).
\item {\ttfamily iov\+\_\+len} would be 817 bytes in total.
\end{DoxyItemize}
\end{DoxyItemize}

The structure of the message is as follows\+: \begin{DoxyVerb}  +------------------+--------------------+----------+
  |    Header        |       Body         |  Footer  |
  |  (64 bits: 9000) |   (Message Data)   | (1 byte) |
  +------------------+--------------------+----------+
\end{DoxyVerb}


The structure of the {\ttfamily iovec} division is\+:

\begin{DoxyVerb}  First iovec (8192 bytes):
  +-----------------------------------------+-----------------------+
  | iov_base                                | iov_len               |
  +-----------------------------------------+-----------------------+
  | 8 bytes header, 8184 bytes of message   | 8192                  |
  +-----------------------------------------+-----------------------+

  Second iovec (817 bytes):
  +-----------------------------------------+-----------------------+
  | iov_base                                | iov_len               |
  +-----------------------------------------+-----------------------+
  | 816 bytes of message, 1 byte footer (0) | 817                   |
  +-----------------------------------------+-----------------------+
\end{DoxyVerb}


Each I/O event can be monitored and managed through custom callbacks that handle connection, read, write, close, or error events on the sockets.

Basic usage example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// Create the saurion structure with 4 threads}}
\DoxyCodeLine{\textcolor{keyword}{struct }\mbox{\hyperlink{structsaurion}{saurion}} *s = \mbox{\hyperlink{group__LowSaurion_gae589ab08ed623ad2ab6d13beec33b131}{saurion\_create}}(4);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Start event processing}}
\DoxyCodeLine{\textcolor{keywordflow}{if} (\mbox{\hyperlink{group__LowSaurion_gaeeab8302b41112175566881a1b7bf905}{saurion\_start}}(s) != 0) \{}
\DoxyCodeLine{    \textcolor{comment}{// Handle the error}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Send a message through a socket}}
\DoxyCodeLine{\mbox{\hyperlink{group__LowSaurion_gadd63cf225e55bcf4cd22ddcbd9d1c9b7}{saurion\_send}}(s, socket\_fd, \textcolor{stringliteral}{"{}Hello, World!"{}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Stop event processing}}
\DoxyCodeLine{\mbox{\hyperlink{group__LowSaurion_ga9f32b41ec23178c2a693fec057b96532}{saurion\_stop}}(s);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Destroy the structure and free resources}}
\DoxyCodeLine{\mbox{\hyperlink{group__LowSaurion_ga7893ccf90a98845d5d95ffda0260d0b8}{saurion\_destroy}}(s);}

\end{DoxyCode}


In this example, the {\ttfamily saurion} structure is created with 4 threads to handle the workload. Event processing is started, allowing it to accept connections and manage I/O operations on sockets. After sending a message through a socket, the system can be stopped, and the resources are freed.

\begin{DoxyAuthor}{Author}
Israel 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2024
\end{DoxyDate}
This function allocates memory for each {\ttfamily struct iovec}. Every {\ttfamily struct iovec} consists of two member variables\+:
\begin{DoxyItemize}
\item {\ttfamily iov\+\_\+base}, a {\ttfamily void $\ast$} array that will hold the data. All of them will allocate the same amount of memory (CHUNK\+\_\+\+SZ) to avoid memory fragmentation.
\item {\ttfamily iov\+\_\+len}, an integer representing the size of the data stored in the {\ttfamily iovec}. The data size is CHUNK\+\_\+\+SZ unless it\textquotesingle{}s the last one, in which case it will hold the remaining bytes. In addition to initialization, the function adds the pointers to the allocated memory into a child array to simplify memory deallocation later on.
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em iov} & Structure to initialize. \\
\hline
{\em amount} & Total number of {\ttfamily iovec} to initialize. \\
\hline
{\em pos} & Current position of the {\ttfamily iovec} within the total {\ttfamily iovec} ({\ttfamily amount}). \\
\hline
{\em size} & Total size of the data to be stored in the {\ttfamily iovec}. \\
\hline
{\em chd\+\_\+ptr} & Array to hold the pointers to the allocated memory.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em ERROR\+\_\+\+CODE} & if there was an error during memory allocation. \\
\hline
{\em SUCCESS\+\_\+\+CODE} & if the operation was successful.\\
\hline
\end{DoxyRetVals}
\begin{DoxyNote}{Note}
The last {\ttfamily iovec} will allocate only the remaining bytes if the total size is not a multiple of CHUNK\+\_\+\+SZ. 
\end{DoxyNote}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{group__LowSaurion_ga7889939b2b6cdf65275305251f749af0}\label{group__LowSaurion_ga7889939b2b6cdf65275305251f749af0}} 
\index{LowSaurion@{LowSaurion}!PACKING\_SZ@{PACKING\_SZ}}
\index{PACKING\_SZ@{PACKING\_SZ}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{PACKING\_SZ}{PACKING\_SZ}}
{\footnotesize\ttfamily \#define PACKING\+\_\+\+SZ~128}



Defines the memory alignment size for structures in the {\ttfamily saurion} class. 

{\ttfamily PACKING\+\_\+\+SZ} is used to ensure that certain structures, such as {\ttfamily \mbox{\hyperlink{structsaurion__callbacks}{saurion\+\_\+callbacks}}}, are aligned to a specific memory boundary. This can improve memory access performance and ensure compatibility with certain hardware architectures that require specific alignment.

In this case, the value is set to 128 bytes, meaning that structures marked with {\ttfamily \+\_\+\+\_\+attribute\+\_\+\+\_\+((aligned(\+PACKING\+\_\+\+SZ)))} will be aligned to 128-\/byte boundaries.

Proper alignment can be particularly important in multithreaded environments or when working with low-\/level system APIs like {\ttfamily io\+\_\+uring}, where unaligned memory accesses may introduce performance penalties.

Adjusting {\ttfamily PACKING\+\_\+\+SZ} may be necessary depending on the hardware platform or specific performance requirements. 

Definition at line \mbox{\hyperlink{low__saurion_8h_source_l00129}{129}} of file \mbox{\hyperlink{low__saurion_8h_source}{low\+\_\+saurion.\+h}}.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{group__LowSaurion_ga1c329b9155a9159b696b60247c9b328b}\label{group__LowSaurion_ga1c329b9155a9159b696b60247c9b328b}} 
\index{LowSaurion@{LowSaurion}!allocate\_iovec@{allocate\_iovec}}
\index{allocate\_iovec@{allocate\_iovec}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{allocate\_iovec()}{allocate\_iovec()}}
{\footnotesize\ttfamily int allocate\+\_\+iovec (\begin{DoxyParamCaption}\item[{struct iovec $\ast$}]{iov,  }\item[{size\+\_\+t}]{amount,  }\item[{size\+\_\+t}]{pos,  }\item[{size\+\_\+t}]{size,  }\item[{void $\ast$$\ast$}]{chd\+\_\+ptr }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00114}{114}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00114                                                                                               \{}
\DoxyCodeLine{00115   \textcolor{keywordflow}{if} (!iov || !chd\_ptr) \{}
\DoxyCodeLine{00116     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00117   \}}
\DoxyCodeLine{00118   iov-\/>iov\_base = malloc(CHUNK\_SZ);}
\DoxyCodeLine{00119   \textcolor{keywordflow}{if} (!iov-\/>iov\_base) \{}
\DoxyCodeLine{00120     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00121   \}}
\DoxyCodeLine{00122   iov-\/>iov\_len = (pos == (amount -\/ 1) ? (size \% CHUNK\_SZ) : CHUNK\_SZ);}
\DoxyCodeLine{00123   \textcolor{keywordflow}{if} (iov-\/>iov\_len == 0) \{}
\DoxyCodeLine{00124     iov-\/>iov\_len = CHUNK\_SZ;}
\DoxyCodeLine{00125   \}}
\DoxyCodeLine{00126   chd\_ptr[pos] = iov-\/>iov\_base;}
\DoxyCodeLine{00127   \textcolor{keywordflow}{return} SUCCESS\_CODE;}
\DoxyCodeLine{00128 \}}

\end{DoxyCode}
\mbox{\Hypertarget{group__LowSaurion_ga4a0bc8233ca030e29b9b94aed0177392}\label{group__LowSaurion_ga4a0bc8233ca030e29b9b94aed0177392}} 
\index{LowSaurion@{LowSaurion}!EXTERNAL\_set\_socket@{EXTERNAL\_set\_socket}}
\index{EXTERNAL\_set\_socket@{EXTERNAL\_set\_socket}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{EXTERNAL\_set\_socket()}{EXTERNAL\_set\_socket()}}
{\footnotesize\ttfamily int EXTERNAL\+\_\+set\+\_\+socket (\begin{DoxyParamCaption}\item[{int}]{p }\end{DoxyParamCaption})}

\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000001}{Todo}}]Eliminar \end{DoxyRefDesc}


Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00548}{548}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00548                                      \{}
\DoxyCodeLine{00549   \textcolor{keywordtype}{int} sock = 0;}
\DoxyCodeLine{00550   \textcolor{keyword}{struct }sockaddr\_in srv\_addr;}
\DoxyCodeLine{00551 }
\DoxyCodeLine{00552   sock = socket(PF\_INET, SOCK\_STREAM, 0);}
\DoxyCodeLine{00553   \textcolor{keywordflow}{if} (sock < 1) \{}
\DoxyCodeLine{00554     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00555   \}}
\DoxyCodeLine{00556 }
\DoxyCodeLine{00557   \textcolor{keywordtype}{int} enable = 1;}
\DoxyCodeLine{00558   \textcolor{keywordflow}{if} (setsockopt(sock, SOL\_SOCKET, SO\_REUSEADDR, \&enable, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int})) < 0) \{}
\DoxyCodeLine{00559     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00560   \}}
\DoxyCodeLine{00561   \textcolor{keywordflow}{if} (setsockopt(sock, SOL\_SOCKET, SO\_REUSEPORT, \&enable, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int})) < 0) \{}
\DoxyCodeLine{00562     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00563   \}}
\DoxyCodeLine{00564 }
\DoxyCodeLine{00565   memset(\&srv\_addr, 0, \textcolor{keyword}{sizeof}(srv\_addr));}
\DoxyCodeLine{00566   srv\_addr.sin\_family = AF\_INET;}
\DoxyCodeLine{00567   srv\_addr.sin\_port = htons(p);}
\DoxyCodeLine{00568   srv\_addr.sin\_addr.s\_addr = htonl(INADDR\_ANY);}
\DoxyCodeLine{00569 }
\DoxyCodeLine{00570   \textcolor{comment}{/* We bind to a port and turn this socket into a listening}}
\DoxyCodeLine{00571 \textcolor{comment}{   * socket.}}
\DoxyCodeLine{00572 \textcolor{comment}{   * */}}
\DoxyCodeLine{00573   \textcolor{keywordflow}{if} (bind(sock, (\textcolor{keyword}{const} \textcolor{keyword}{struct} sockaddr *)\&srv\_addr, \textcolor{keyword}{sizeof}(srv\_addr)) < 0) \{}
\DoxyCodeLine{00574     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00575   \}}
\DoxyCodeLine{00576 }
\DoxyCodeLine{00577   \textcolor{keywordflow}{if} (listen(sock, ACCEPT\_QUEUE) < 0) \{}
\DoxyCodeLine{00578     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00579   \}}
\DoxyCodeLine{00580 }
\DoxyCodeLine{00581   \textcolor{keywordflow}{return} sock;}
\DoxyCodeLine{00582 \}}

\end{DoxyCode}
\mbox{\Hypertarget{group__LowSaurion_ga0f9760bc800b946244ccf790081e6bb3}\label{group__LowSaurion_ga0f9760bc800b946244ccf790081e6bb3}} 
\index{LowSaurion@{LowSaurion}!free\_request@{free\_request}}
\index{free\_request@{free\_request}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{free\_request()}{free\_request()}}
{\footnotesize\ttfamily void free\+\_\+request (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structrequest}{request}} $\ast$}]{req,  }\item[{void $\ast$$\ast$}]{children\+\_\+ptr,  }\item[{size\+\_\+t}]{amount }\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00061}{61}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00061                                                                            \{}
\DoxyCodeLine{00062   \textcolor{keywordflow}{if} (children\_ptr) \{}
\DoxyCodeLine{00063     free(children\_ptr);}
\DoxyCodeLine{00064     children\_ptr = NULL;}
\DoxyCodeLine{00065   \}}
\DoxyCodeLine{00066   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < amount; ++i) \{}
\DoxyCodeLine{00067     free(req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[i].iov\_base);}
\DoxyCodeLine{00068     req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[i].iov\_base = NULL;}
\DoxyCodeLine{00069   \}}
\DoxyCodeLine{00070   free(req);}
\DoxyCodeLine{00071   req = NULL;}
\DoxyCodeLine{00072   free(children\_ptr);}
\DoxyCodeLine{00073   children\_ptr = NULL;}
\DoxyCodeLine{00074 \}}

\end{DoxyCode}
\mbox{\Hypertarget{group__LowSaurion_gae64e81c0ce5f52d51684d8f1129e6076}\label{group__LowSaurion_gae64e81c0ce5f52d51684d8f1129e6076}} 
\index{LowSaurion@{LowSaurion}!initialize\_iovec@{initialize\_iovec}}
\index{initialize\_iovec@{initialize\_iovec}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{initialize\_iovec()}{initialize\_iovec()}}
{\footnotesize\ttfamily int initialize\+\_\+iovec (\begin{DoxyParamCaption}\item[{struct iovec $\ast$}]{iov,  }\item[{size\+\_\+t}]{amount,  }\item[{size\+\_\+t}]{pos,  }\item[{const void $\ast$}]{msg,  }\item[{size\+\_\+t}]{size,  }\item[{uint8\+\_\+t}]{h }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Initializes a specified {\ttfamily iovec} structure with a message fragment. 

This function populates the {\ttfamily iov\+\_\+base} of the {\ttfamily iovec} structure with a portion of the message, depending on the position ({\ttfamily pos}) in the overall set of iovec structures. The message is divided into chunks, and for the first {\ttfamily iovec}, a header containing the size of the message is included. Optionally, padding or adjustments can be applied based on the {\ttfamily h} flag.


\begin{DoxyParams}{Parameters}
{\em iov} & Pointer to the {\ttfamily iovec} structure to initialize. \\
\hline
{\em amount} & The total number of {\ttfamily iovec} structures. \\
\hline
{\em pos} & The current position of the {\ttfamily iovec} within the overall message split. \\
\hline
{\em msg} & Pointer to the message to be split across the {\ttfamily iovec} structures. \\
\hline
{\em size} & The total size of the message. \\
\hline
{\em h} & A flag (header flag) that indicates whether special handling is needed for the first {\ttfamily iovec} (adds the message size as a header) or for the last chunk.\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em SUCCESS\+\_\+\+CODE} & on successful initialization of the {\ttfamily iovec}. \\
\hline
{\em ERROR\+\_\+\+CODE} & if the {\ttfamily iov} or its {\ttfamily iov\+\_\+base} is null.\\
\hline
\end{DoxyRetVals}
\begin{DoxyNote}{Note}
For the first {\ttfamily iovec} (when {\ttfamily pos == 0}), the message size is copied into the beginning of the {\ttfamily iov\+\_\+base} if the header flag ({\ttfamily h}) is set. Subsequent chunks are filled with message data, and the last chunk may have one byte reduced if {\ttfamily h} is set.
\end{DoxyNote}
\begin{DoxyAttention}{Attention}
The message must be properly aligned and divided, especially when using the header flag to ensure no memory access issues.
\end{DoxyAttention}
\begin{DoxyWarning}{Warning}
If {\ttfamily msg} is null, the function will initialize the {\ttfamily iov\+\_\+base} with zeros, essentially resetting the buffer. 
\end{DoxyWarning}


Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00077}{77}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00078                                 \{}
\DoxyCodeLine{00079   \textcolor{keywordflow}{if} (!iov || !iov-\/>iov\_base) \{}
\DoxyCodeLine{00080     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00081   \}}
\DoxyCodeLine{00082   \textcolor{keywordflow}{if} (msg) \{}
\DoxyCodeLine{00083     \textcolor{keywordtype}{size\_t} len = iov-\/>iov\_len;}
\DoxyCodeLine{00084     \textcolor{keywordtype}{char} *dest = (\textcolor{keywordtype}{char} *)iov-\/>iov\_base;}
\DoxyCodeLine{00085     \textcolor{keywordtype}{char} *orig = (\textcolor{keywordtype}{char} *)msg + pos * CHUNK\_SZ;}
\DoxyCodeLine{00086     \textcolor{keywordtype}{size\_t} cpy\_sz = 0;}
\DoxyCodeLine{00087     \textcolor{keywordflow}{if} (h) \{}
\DoxyCodeLine{00088       \textcolor{keywordflow}{if} (pos == 0) \{}
\DoxyCodeLine{00089         uint64\_t send\_size = \mbox{\hyperlink{low__saurion_8c_a00d80bc019becac44a598996923faecf}{htonll}}(size);}
\DoxyCodeLine{00090         memcpy(dest, \&send\_size, \textcolor{keyword}{sizeof}(uint64\_t));}
\DoxyCodeLine{00091         dest += \textcolor{keyword}{sizeof}(uint64\_t);}
\DoxyCodeLine{00092         len -\/= \textcolor{keyword}{sizeof}(uint64\_t);}
\DoxyCodeLine{00093       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00094         orig -\/= \textcolor{keyword}{sizeof}(uint64\_t);}
\DoxyCodeLine{00095       \}}
\DoxyCodeLine{00096       \textcolor{keywordflow}{if} ((pos + 1) == amount) \{}
\DoxyCodeLine{00097         -\/-\/len;}
\DoxyCodeLine{00098         cpy\_sz = (len < size ? len : size);}
\DoxyCodeLine{00099         dest[cpy\_sz] = 0;}
\DoxyCodeLine{00100       \}}
\DoxyCodeLine{00101     \}}
\DoxyCodeLine{00102     cpy\_sz = (len < size ? len : size);}
\DoxyCodeLine{00103     memcpy(dest, orig, cpy\_sz);}
\DoxyCodeLine{00104     dest += cpy\_sz;}
\DoxyCodeLine{00105     \textcolor{keywordtype}{size\_t} rem = CHUNK\_SZ -\/ (dest -\/ (\textcolor{keywordtype}{char} *)iov-\/>iov\_base);}
\DoxyCodeLine{00106     memset(dest, 0, rem);}
\DoxyCodeLine{00107   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00108     memset((\textcolor{keywordtype}{char} *)iov-\/>iov\_base, 0, CHUNK\_SZ);}
\DoxyCodeLine{00109   \}}
\DoxyCodeLine{00110   \textcolor{keywordflow}{return} SUCCESS\_CODE;}
\DoxyCodeLine{00111 \}}

\end{DoxyCode}
\mbox{\Hypertarget{group__LowSaurion_gaec24df6ee2f4999bf64acf5fc42ed019}\label{group__LowSaurion_gaec24df6ee2f4999bf64acf5fc42ed019}} 
\index{LowSaurion@{LowSaurion}!read\_chunk@{read\_chunk}}
\index{read\_chunk@{read\_chunk}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{read\_chunk()}{read\_chunk()}}
{\footnotesize\ttfamily int read\+\_\+chunk (\begin{DoxyParamCaption}\item[{void $\ast$$\ast$}]{dest,  }\item[{size\+\_\+t $\ast$}]{len,  }\item[{struct \mbox{\hyperlink{structrequest}{request}} $\ast$const}]{req }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Reads a message chunk from the request\textquotesingle{}s iovec buffers, handling messages that may span multiple iovec entries. 

This function processes data from a {\ttfamily struct request}, which contains an array of {\ttfamily iovec} structures representing buffered data. Each message in the buffers starts with a {\ttfamily size\+\_\+t} value indicating the size of the message, followed by the message content. The function reads the message size, allocates a buffer for the message content, and copies the data from the iovec buffers into this buffer. It handles messages that span multiple iovec entries and manages incomplete messages by storing partial data within the request structure for subsequent reads.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em dest} & Pointer to a variable where the address of the allocated message buffer will be stored. The buffer is allocated by the function and must be freed by the caller. \\
\hline
\mbox{\texttt{ out}}  & {\em len} & Pointer to a {\ttfamily size\+\_\+t} variable where the length of the read message will be stored. If a complete message is read, {\ttfamily $\ast$len} is set to the message size. If the message is incomplete, {\ttfamily $\ast$len} is set to 0. \\
\hline
\mbox{\texttt{ in,out}}  & {\em req} & Pointer to a {\ttfamily struct request} containing the iovec buffers and state information. The function updates the request\textquotesingle{}s state to track the current position within the iovecs and any incomplete messages.\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
The function assumes that each message is prefixed with its size (of type {\ttfamily size\+\_\+t}), and that messages may span multiple iovec entries. It also assumes that the data in the iovec buffers is valid and properly aligned for reading {\ttfamily size\+\_\+t} values.
\end{DoxyNote}
\begin{DoxyWarning}{Warning}
The caller is responsible for freeing the allocated message buffer pointed to by {\ttfamily $\ast$dest} when it is no longer needed.
\end{DoxyWarning}
\begin{DoxyReturn}{Returns}
int Returns SUCCESS\+\_\+\+CODE on success, or ERROR\+\_\+\+CODE on failure (malformed msg). 
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em SUCCESS\+\_\+\+CODE} & No malformed message found. \\
\hline
{\em ERROR\+\_\+\+CODE} & Malformed message found. \\
\hline
\end{DoxyRetVals}
\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000002}{Todo}}]add message contraint 

validar {\ttfamily msg\+\_\+size}, crear maximos 

validar {\ttfamily offsets} \end{DoxyRefDesc}
Remaining bytes of the message (content + header + foot) stored in the current IOVEC

Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00350}{350}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00350                                                                     \{}
\DoxyCodeLine{00351   \textcolor{comment}{// Initial checks}}
\DoxyCodeLine{00352   \textcolor{keywordflow}{if} (req-\/>\mbox{\hyperlink{structrequest_a1291bf32fbcafa3bb4b348578db09a9f}{iovec\_count}} == 0) \{}
\DoxyCodeLine{00353     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00354   \}}
\DoxyCodeLine{00355 }
\DoxyCodeLine{00356   \textcolor{comment}{// Initizalization}}
\DoxyCodeLine{00357   \textcolor{keywordtype}{size\_t} max\_iov\_cont = 0;  \textcolor{comment}{//< Total size of request}}
\DoxyCodeLine{00358   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < req-\/>\mbox{\hyperlink{structrequest_a1291bf32fbcafa3bb4b348578db09a9f}{iovec\_count}}; ++i) \{}
\DoxyCodeLine{00359     max\_iov\_cont += req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[i].iov\_len;}
\DoxyCodeLine{00360   \}}
\DoxyCodeLine{00361   \textcolor{keywordtype}{size\_t} cont\_sz = 0;       \textcolor{comment}{//< Message content size}}
\DoxyCodeLine{00362   \textcolor{keywordtype}{size\_t} cont\_rem = 0;      \textcolor{comment}{//< Remaining bytes of message content}}
\DoxyCodeLine{00363   \textcolor{keywordtype}{size\_t} curr\_iov = 0;      \textcolor{comment}{//< IOVEC num currently reading}}
\DoxyCodeLine{00364   \textcolor{keywordtype}{size\_t} curr\_iov\_off = 0;  \textcolor{comment}{//< Offset in bytes of the current IOVEC}}
\DoxyCodeLine{00365   \textcolor{keywordtype}{size\_t} dest\_off = 0;      \textcolor{comment}{//< Write offset on the destiny array}}
\DoxyCodeLine{00366   \textcolor{keywordtype}{void} *dest\_ptr = NULL;    \textcolor{comment}{//< Destiny pointer, could be dest or prev}}
\DoxyCodeLine{00367   \textcolor{keywordflow}{if} (req-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}} \&\& req-\/>\mbox{\hyperlink{structrequest_a02dc8e759c5216e1b7f7c908a0e0481f}{prev\_size}} \&\& req-\/>\mbox{\hyperlink{structrequest_acb69c014fb67502b59cd112d3758569f}{prev\_remain}}) \{}
\DoxyCodeLine{00368     \textcolor{comment}{// There's a previous unfinished message}}
\DoxyCodeLine{00369     cont\_sz = req-\/>\mbox{\hyperlink{structrequest_a02dc8e759c5216e1b7f7c908a0e0481f}{prev\_size}};}
\DoxyCodeLine{00370     cont\_rem = req-\/>\mbox{\hyperlink{structrequest_acb69c014fb67502b59cd112d3758569f}{prev\_remain}};}
\DoxyCodeLine{00371     curr\_iov = 0;}
\DoxyCodeLine{00372     curr\_iov\_off = 0;}
\DoxyCodeLine{00373     dest\_off = cont\_sz -\/ cont\_rem;}
\DoxyCodeLine{00374     \textcolor{keywordflow}{if} (cont\_rem <= max\_iov\_cont) \{}
\DoxyCodeLine{00375       *dest = req-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}};}
\DoxyCodeLine{00376       dest\_ptr = *dest;}
\DoxyCodeLine{00377       req-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}} = NULL;}
\DoxyCodeLine{00378       req-\/>\mbox{\hyperlink{structrequest_a02dc8e759c5216e1b7f7c908a0e0481f}{prev\_size}} = 0;}
\DoxyCodeLine{00379       req-\/>\mbox{\hyperlink{structrequest_acb69c014fb67502b59cd112d3758569f}{prev\_remain}} = 0;}
\DoxyCodeLine{00380     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00381       dest\_ptr = req-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}};}
\DoxyCodeLine{00382       *dest = NULL;}
\DoxyCodeLine{00383     \}}
\DoxyCodeLine{00384   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (req-\/>\mbox{\hyperlink{structrequest_a4aba582d3fcf1110aa8f272d5b038a3d}{next\_iov}} || req-\/>\mbox{\hyperlink{structrequest_a03abde14b48986b40d827b22e4ddfb2d}{next\_offset}}) \{}
\DoxyCodeLine{00385     \textcolor{comment}{// Reading the next message}}
\DoxyCodeLine{00386     curr\_iov = req-\/>\mbox{\hyperlink{structrequest_a4aba582d3fcf1110aa8f272d5b038a3d}{next\_iov}};}
\DoxyCodeLine{00387     curr\_iov\_off = req-\/>\mbox{\hyperlink{structrequest_a03abde14b48986b40d827b22e4ddfb2d}{next\_offset}};}
\DoxyCodeLine{00388     cont\_sz = *((\textcolor{keywordtype}{size\_t} *)(req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[curr\_iov].iov\_base + curr\_iov\_off));}
\DoxyCodeLine{00389     cont\_sz = \mbox{\hyperlink{low__saurion_8c_a5fae4cad12b0ca469184e097624aea08}{ntohll}}(cont\_sz);}
\DoxyCodeLine{00390     curr\_iov\_off += \textcolor{keyword}{sizeof}(uint64\_t);}
\DoxyCodeLine{00391     cont\_rem = cont\_sz;}
\DoxyCodeLine{00392     dest\_off = cont\_sz -\/ cont\_rem;}
\DoxyCodeLine{00393     \textcolor{keywordflow}{if} ((curr\_iov\_off + cont\_rem + 1) <= max\_iov\_cont) \{}
\DoxyCodeLine{00394       *dest = malloc(cont\_sz);}
\DoxyCodeLine{00395       dest\_ptr = *dest;}
\DoxyCodeLine{00396     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00397       req-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}} = malloc(cont\_sz);}
\DoxyCodeLine{00398       dest\_ptr = req-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}};}
\DoxyCodeLine{00399       *dest = NULL;}
\DoxyCodeLine{00400       *len = 0;}
\DoxyCodeLine{00401     \}}
\DoxyCodeLine{00402   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00403     \textcolor{comment}{// Reading the first message}}
\DoxyCodeLine{00404     curr\_iov = 0;}
\DoxyCodeLine{00405     curr\_iov\_off = 0;}
\DoxyCodeLine{00406     cont\_sz = *((\textcolor{keywordtype}{size\_t} *)(req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[curr\_iov].iov\_base + curr\_iov\_off));}
\DoxyCodeLine{00407     cont\_sz = \mbox{\hyperlink{low__saurion_8c_a5fae4cad12b0ca469184e097624aea08}{ntohll}}(cont\_sz);}
\DoxyCodeLine{00408     curr\_iov\_off += \textcolor{keyword}{sizeof}(uint64\_t);}
\DoxyCodeLine{00409     cont\_rem = cont\_sz;}
\DoxyCodeLine{00410     dest\_off = cont\_sz -\/ cont\_rem;}
\DoxyCodeLine{00411     \textcolor{keywordflow}{if} (cont\_rem <= max\_iov\_cont) \{}
\DoxyCodeLine{00412       *dest = malloc(cont\_sz);}
\DoxyCodeLine{00413       dest\_ptr = *dest;}
\DoxyCodeLine{00414     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00415       req-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}} = malloc(cont\_sz);}
\DoxyCodeLine{00416       dest\_ptr = req-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}};}
\DoxyCodeLine{00417       *dest = NULL;}
\DoxyCodeLine{00418     \}}
\DoxyCodeLine{00419   \}}
\DoxyCodeLine{00421   \textcolor{keywordtype}{size\_t} curr\_iov\_msg\_rem = 0;}
\DoxyCodeLine{00422 }
\DoxyCodeLine{00423   \textcolor{comment}{// Copy loop}}
\DoxyCodeLine{00424   uint8\_t ok = 1UL;}
\DoxyCodeLine{00425   \textcolor{keywordflow}{while} (1) \{}
\DoxyCodeLine{00426     curr\_iov\_msg\_rem = \mbox{\hyperlink{low__saurion_8c_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}}(cont\_rem, (req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[curr\_iov].iov\_len -\/ curr\_iov\_off));}
\DoxyCodeLine{00427     memcpy(dest\_ptr + dest\_off, req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[curr\_iov].iov\_base + curr\_iov\_off, curr\_iov\_msg\_rem);}
\DoxyCodeLine{00428     dest\_off += curr\_iov\_msg\_rem;}
\DoxyCodeLine{00429     curr\_iov\_off += curr\_iov\_msg\_rem;}
\DoxyCodeLine{00430     cont\_rem -\/= curr\_iov\_msg\_rem;}
\DoxyCodeLine{00431     \textcolor{keywordflow}{if} (cont\_rem <= 0) \{}
\DoxyCodeLine{00432       \textcolor{comment}{// Finish reading}}
\DoxyCodeLine{00433       \textcolor{keywordflow}{if} (*((uint8\_t *)(req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[curr\_iov].iov\_base + curr\_iov\_off)) != 0) \{}
\DoxyCodeLine{00434         ok = 0UL;}
\DoxyCodeLine{00435       \}}
\DoxyCodeLine{00436       *len = cont\_sz;}
\DoxyCodeLine{00437       ++curr\_iov\_off;}
\DoxyCodeLine{00438       \textcolor{keywordflow}{break};}
\DoxyCodeLine{00439     \}}
\DoxyCodeLine{00440     \textcolor{keywordflow}{if} (curr\_iov\_off >= (req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[curr\_iov].iov\_len)) \{}
\DoxyCodeLine{00441       ++curr\_iov;}
\DoxyCodeLine{00442       \textcolor{keywordflow}{if} (curr\_iov == req-\/>\mbox{\hyperlink{structrequest_a1291bf32fbcafa3bb4b348578db09a9f}{iovec\_count}}) \{}
\DoxyCodeLine{00443         \textcolor{keywordflow}{break};}
\DoxyCodeLine{00444       \}}
\DoxyCodeLine{00445       curr\_iov\_off = 0;}
\DoxyCodeLine{00446     \}}
\DoxyCodeLine{00447   \}}
\DoxyCodeLine{00448 }
\DoxyCodeLine{00449   \textcolor{comment}{// Update status}}
\DoxyCodeLine{00450   \textcolor{keywordflow}{if} (req-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}}) \{}
\DoxyCodeLine{00451     req-\/>\mbox{\hyperlink{structrequest_a02dc8e759c5216e1b7f7c908a0e0481f}{prev\_size}} = cont\_sz;}
\DoxyCodeLine{00452     req-\/>\mbox{\hyperlink{structrequest_acb69c014fb67502b59cd112d3758569f}{prev\_remain}} = cont\_rem;}
\DoxyCodeLine{00453     *dest = NULL;}
\DoxyCodeLine{00454     len = 0;}
\DoxyCodeLine{00455   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00456     req-\/>\mbox{\hyperlink{structrequest_a02dc8e759c5216e1b7f7c908a0e0481f}{prev\_size}} = 0;}
\DoxyCodeLine{00457     req-\/>\mbox{\hyperlink{structrequest_acb69c014fb67502b59cd112d3758569f}{prev\_remain}} = 0;}
\DoxyCodeLine{00458   \}}
\DoxyCodeLine{00459   \textcolor{keywordflow}{if} (curr\_iov < req-\/>iovec\_count) \{}
\DoxyCodeLine{00460     uint64\_t next\_sz = *(uint64\_t *)(req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[curr\_iov].iov\_base + curr\_iov\_off);}
\DoxyCodeLine{00461     \textcolor{keywordflow}{if} ((req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[curr\_iov].iov\_len > curr\_iov\_off) \&\& next\_sz) \{}
\DoxyCodeLine{00462       req-\/>\mbox{\hyperlink{structrequest_a4aba582d3fcf1110aa8f272d5b038a3d}{next\_iov}} = curr\_iov;}
\DoxyCodeLine{00463       req-\/>\mbox{\hyperlink{structrequest_a03abde14b48986b40d827b22e4ddfb2d}{next\_offset}} = curr\_iov\_off;}
\DoxyCodeLine{00464     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00465       req-\/>\mbox{\hyperlink{structrequest_a4aba582d3fcf1110aa8f272d5b038a3d}{next\_iov}} = 0;}
\DoxyCodeLine{00466       req-\/>\mbox{\hyperlink{structrequest_a03abde14b48986b40d827b22e4ddfb2d}{next\_offset}} = 0;}
\DoxyCodeLine{00467     \}}
\DoxyCodeLine{00468   \}}
\DoxyCodeLine{00469 }
\DoxyCodeLine{00470   \textcolor{comment}{// Finish}}
\DoxyCodeLine{00471   \textcolor{keywordflow}{if} (!ok) \{}
\DoxyCodeLine{00472     \textcolor{comment}{// Esto solo es posible si no se encuentra un 0 al final del la lectura}}
\DoxyCodeLine{00473     \textcolor{comment}{// buscar el siguiente 0 y ... probar fortuna}}
\DoxyCodeLine{00474     free(dest\_ptr);}
\DoxyCodeLine{00475     dest\_ptr = NULL;}
\DoxyCodeLine{00476     *dest = NULL;}
\DoxyCodeLine{00477     *len = 0;}
\DoxyCodeLine{00478     req-\/>\mbox{\hyperlink{structrequest_a4aba582d3fcf1110aa8f272d5b038a3d}{next\_iov}} = 0;}
\DoxyCodeLine{00479     req-\/>\mbox{\hyperlink{structrequest_a03abde14b48986b40d827b22e4ddfb2d}{next\_offset}} = 0;}
\DoxyCodeLine{00480     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = curr\_iov; i < req-\/>\mbox{\hyperlink{structrequest_a1291bf32fbcafa3bb4b348578db09a9f}{iovec\_count}}; ++i) \{}
\DoxyCodeLine{00481       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = curr\_iov\_off; j < req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[i].iov\_len; ++j) \{}
\DoxyCodeLine{00482         uint8\_t foot = *(uint8\_t *)(req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[i].iov\_base + j);}
\DoxyCodeLine{00483         \textcolor{keywordflow}{if} (foot == 0) \{}
\DoxyCodeLine{00484           req-\/>\mbox{\hyperlink{structrequest_a4aba582d3fcf1110aa8f272d5b038a3d}{next\_iov}} = i;}
\DoxyCodeLine{00485           req-\/>\mbox{\hyperlink{structrequest_a03abde14b48986b40d827b22e4ddfb2d}{next\_offset}} = (j + 1) \% req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[i].iov\_len;}
\DoxyCodeLine{00486           \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00487         \}}
\DoxyCodeLine{00488       \}}
\DoxyCodeLine{00489     \}}
\DoxyCodeLine{00490     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00491   \}}
\DoxyCodeLine{00492   \textcolor{keywordflow}{return} SUCCESS\_CODE;}
\DoxyCodeLine{00493 \}}

\end{DoxyCode}
\mbox{\Hypertarget{group__LowSaurion_gae589ab08ed623ad2ab6d13beec33b131}\label{group__LowSaurion_gae589ab08ed623ad2ab6d13beec33b131}} 
\index{LowSaurion@{LowSaurion}!saurion\_create@{saurion\_create}}
\index{saurion\_create@{saurion\_create}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{saurion\_create()}{saurion\_create()}}
{\footnotesize\ttfamily struct \mbox{\hyperlink{structsaurion}{saurion}} $\ast$ saurion\+\_\+create (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{n\+\_\+threads }\end{DoxyParamCaption})}



Creates an instance of the {\ttfamily saurion} structure. 

This function initializes the {\ttfamily saurion} structure, sets up the eventfd, and configures the io\+\_\+uring queue, preparing it for use. It also sets up the thread pool and any necessary synchronization mechanisms.


\begin{DoxyParams}{Parameters}
{\em n\+\_\+threads} & The number of threads to initialize in the thread pool. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
struct saurion$\ast$ A pointer to the newly created {\ttfamily saurion} structure, or NULL if an error occurs. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00585}{585}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00585                                                    \{}
\DoxyCodeLine{00586   \textcolor{comment}{// Asignar memoria}}
\DoxyCodeLine{00587   \textcolor{keyword}{struct }\mbox{\hyperlink{structsaurion}{saurion}} *p = (\textcolor{keyword}{struct }\mbox{\hyperlink{structsaurion}{saurion}} *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \mbox{\hyperlink{structsaurion}{saurion}}));}
\DoxyCodeLine{00588   \textcolor{keywordflow}{if} (!p) \{}
\DoxyCodeLine{00589     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{00590   \}}
\DoxyCodeLine{00591   \textcolor{comment}{// Inicializar mutex}}
\DoxyCodeLine{00592   \textcolor{keywordtype}{int} ret = 0;}
\DoxyCodeLine{00593   ret = pthread\_mutex\_init(\&p-\/>\mbox{\hyperlink{structsaurion_ad05334ffef73d89577b3bc60ecc11283}{status\_m}}, NULL);}
\DoxyCodeLine{00594   \textcolor{keywordflow}{if} (ret) \{}
\DoxyCodeLine{00595     free(p);}
\DoxyCodeLine{00596     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{00597   \}}
\DoxyCodeLine{00598   ret = pthread\_cond\_init(\&p-\/>\mbox{\hyperlink{structsaurion_add5f25d5f709bda89fa5461eecdc2b2e}{status\_c}}, NULL);}
\DoxyCodeLine{00599   \textcolor{keywordflow}{if} (ret) \{}
\DoxyCodeLine{00600     free(p);}
\DoxyCodeLine{00601     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{00602   \}}
\DoxyCodeLine{00603   p-\/>\mbox{\hyperlink{structsaurion_ad3305571e32bbb72bc95caefbb68b030}{m\_rings}} = (pthread\_mutex\_t *)malloc(\mbox{\hyperlink{low__saurion_8h_a7001c0d6b3bf1fa114a0d230c6190e3d}{n\_threads}} * \textcolor{keyword}{sizeof}(pthread\_mutex\_t));}
\DoxyCodeLine{00604   \textcolor{keywordflow}{if} (!p-\/>\mbox{\hyperlink{structsaurion_ad3305571e32bbb72bc95caefbb68b030}{m\_rings}}) \{}
\DoxyCodeLine{00605     free(p);}
\DoxyCodeLine{00606     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{00607   \}}
\DoxyCodeLine{00608   \textcolor{keywordflow}{for} (uint32\_t i = 0; i < \mbox{\hyperlink{low__saurion_8h_a7001c0d6b3bf1fa114a0d230c6190e3d}{n\_threads}}; ++i) \{}
\DoxyCodeLine{00609     pthread\_mutex\_init(\&(p-\/>\mbox{\hyperlink{structsaurion_ad3305571e32bbb72bc95caefbb68b030}{m\_rings}}[i]), NULL);}
\DoxyCodeLine{00610   \}}
\DoxyCodeLine{00611   \textcolor{comment}{// Inicializar miembros}}
\DoxyCodeLine{00612   p-\/>\mbox{\hyperlink{structsaurion_ae85c8eed456efd00dcc93d005b0ad99c}{ss}} = 0;}
\DoxyCodeLine{00613   \mbox{\hyperlink{low__saurion_8h_a7001c0d6b3bf1fa114a0d230c6190e3d}{n\_threads}} = (\mbox{\hyperlink{low__saurion_8h_a7001c0d6b3bf1fa114a0d230c6190e3d}{n\_threads}} < 2 ? 2 : \mbox{\hyperlink{low__saurion_8h_a7001c0d6b3bf1fa114a0d230c6190e3d}{n\_threads}});}
\DoxyCodeLine{00614   \mbox{\hyperlink{low__saurion_8h_a7001c0d6b3bf1fa114a0d230c6190e3d}{n\_threads}} = (\mbox{\hyperlink{low__saurion_8h_a7001c0d6b3bf1fa114a0d230c6190e3d}{n\_threads}} > NUM\_CORES ? NUM\_CORES : \mbox{\hyperlink{low__saurion_8h_a7001c0d6b3bf1fa114a0d230c6190e3d}{n\_threads}});}
\DoxyCodeLine{00615   p-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}} = \mbox{\hyperlink{low__saurion_8h_a7001c0d6b3bf1fa114a0d230c6190e3d}{n\_threads}};}
\DoxyCodeLine{00616   p-\/>\mbox{\hyperlink{structsaurion_a342abf92b861ebc82e50349fe31246e2}{status}} = 0;}
\DoxyCodeLine{00617   p-\/>\mbox{\hyperlink{structsaurion_a63c38a9dc703180b628935d72236318f}{list}} = NULL;}
\DoxyCodeLine{00618   p-\/>cb.on\_connected = NULL;}
\DoxyCodeLine{00619   p-\/>cb.on\_connected\_arg = NULL;}
\DoxyCodeLine{00620   p-\/>cb.on\_readed = NULL;}
\DoxyCodeLine{00621   p-\/>cb.on\_readed\_arg = NULL;}
\DoxyCodeLine{00622   p-\/>cb.on\_wrote = NULL;}
\DoxyCodeLine{00623   p-\/>cb.on\_wrote\_arg = NULL;}
\DoxyCodeLine{00624   p-\/>cb.on\_closed = NULL;}
\DoxyCodeLine{00625   p-\/>cb.on\_closed\_arg = NULL;}
\DoxyCodeLine{00626   p-\/>cb.on\_error = NULL;}
\DoxyCodeLine{00627   p-\/>cb.on\_error\_arg = NULL;}
\DoxyCodeLine{00628   p-\/>\mbox{\hyperlink{structsaurion_a2742eddc30d4e4409b9f1a98cf7eb054}{next}} = 0;}
\DoxyCodeLine{00629   \textcolor{comment}{// Inicializar efds}}
\DoxyCodeLine{00630   p-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}} = (\textcolor{keywordtype}{int} *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}) * p-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}});}
\DoxyCodeLine{00631   \textcolor{keywordflow}{if} (!p-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}}) \{}
\DoxyCodeLine{00632     free(p-\/>\mbox{\hyperlink{structsaurion_ad3305571e32bbb72bc95caefbb68b030}{m\_rings}});}
\DoxyCodeLine{00633     free(p);}
\DoxyCodeLine{00634     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{00635   \}}
\DoxyCodeLine{00636   \textcolor{keywordflow}{for} (uint32\_t i = 0; i < p-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}}; ++i) \{}
\DoxyCodeLine{00637     p-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}}[i] = eventfd(0, EFD\_NONBLOCK);}
\DoxyCodeLine{00638     \textcolor{keywordflow}{if} (p-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}}[i] == ERROR\_CODE) \{}
\DoxyCodeLine{00639       \textcolor{keywordflow}{for} (uint32\_t j = 0; j < i; ++j) \{}
\DoxyCodeLine{00640         close(p-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}}[j]);}
\DoxyCodeLine{00641       \}}
\DoxyCodeLine{00642       free(p-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}});}
\DoxyCodeLine{00643       free(p-\/>\mbox{\hyperlink{structsaurion_ad3305571e32bbb72bc95caefbb68b030}{m\_rings}});}
\DoxyCodeLine{00644       free(p);}
\DoxyCodeLine{00645       \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{00646     \}}
\DoxyCodeLine{00647   \}}
\DoxyCodeLine{00648   \textcolor{comment}{// Inicializar rings}}
\DoxyCodeLine{00649   p-\/>\mbox{\hyperlink{structsaurion_a4858f070287e6269298089b993793830}{rings}} = (\textcolor{keyword}{struct }io\_uring *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} io\_uring) * p-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}});}
\DoxyCodeLine{00650   \textcolor{keywordflow}{if} (!p-\/>\mbox{\hyperlink{structsaurion_a4858f070287e6269298089b993793830}{rings}}) \{}
\DoxyCodeLine{00651     \textcolor{keywordflow}{for} (uint32\_t j = 0; j < p-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}}; ++j) \{}
\DoxyCodeLine{00652       close(p-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}}[j]);}
\DoxyCodeLine{00653     \}}
\DoxyCodeLine{00654     free(p-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}});}
\DoxyCodeLine{00655     free(p-\/>\mbox{\hyperlink{structsaurion_ad3305571e32bbb72bc95caefbb68b030}{m\_rings}});}
\DoxyCodeLine{00656     free(p);}
\DoxyCodeLine{00657     \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{00658   \}}
\DoxyCodeLine{00659   \textcolor{keywordflow}{for} (uint32\_t i = 0; i < p-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}}; ++i) \{}
\DoxyCodeLine{00660     memset(\&p-\/>\mbox{\hyperlink{structsaurion_a4858f070287e6269298089b993793830}{rings}}[i], 0, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} io\_uring));}
\DoxyCodeLine{00661     ret = io\_uring\_queue\_init(SAURION\_RING\_SIZE, \&p-\/>\mbox{\hyperlink{structsaurion_a4858f070287e6269298089b993793830}{rings}}[i], 0);}
\DoxyCodeLine{00662     \textcolor{keywordflow}{if} (ret) \{}
\DoxyCodeLine{00663       \textcolor{keywordflow}{for} (uint32\_t j = 0; j < p-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}}; ++j) \{}
\DoxyCodeLine{00664         close(p-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}}[j]);}
\DoxyCodeLine{00665       \}}
\DoxyCodeLine{00666       free(p-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}});}
\DoxyCodeLine{00667       free(p-\/>\mbox{\hyperlink{structsaurion_a4858f070287e6269298089b993793830}{rings}});}
\DoxyCodeLine{00668       free(p-\/>\mbox{\hyperlink{structsaurion_ad3305571e32bbb72bc95caefbb68b030}{m\_rings}});}
\DoxyCodeLine{00669       free(p);}
\DoxyCodeLine{00670       \textcolor{keywordflow}{return} NULL;}
\DoxyCodeLine{00671     \}}
\DoxyCodeLine{00672   \}}
\DoxyCodeLine{00673   p-\/>\mbox{\hyperlink{structsaurion_aa6d22bb06ad66a5a860fcd642b4e7905}{pool}} = \mbox{\hyperlink{cthreadpool_8cpp_a7050a8290c4fd93b7091f84097f4c1c0}{ThreadPool\_create}}(p-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}});}
\DoxyCodeLine{00674   \textcolor{keywordflow}{return} p;}
\DoxyCodeLine{00675 \}}

\end{DoxyCode}
\mbox{\Hypertarget{group__LowSaurion_ga7893ccf90a98845d5d95ffda0260d0b8}\label{group__LowSaurion_ga7893ccf90a98845d5d95ffda0260d0b8}} 
\index{LowSaurion@{LowSaurion}!saurion\_destroy@{saurion\_destroy}}
\index{saurion\_destroy@{saurion\_destroy}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{saurion\_destroy()}{saurion\_destroy()}}
{\footnotesize\ttfamily void saurion\+\_\+destroy (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structsaurion}{saurion}} $\ast$}]{s }\end{DoxyParamCaption})}



Destroys the {\ttfamily saurion} structure and frees all associated resources. 

This function waits for the event processing to stop, frees the memory used by the {\ttfamily saurion} structure, and closes any open file descriptors. It ensures that no resources are leaked when the structure is no longer needed.


\begin{DoxyParams}{Parameters}
{\em s} & Pointer to the {\ttfamily saurion} structure. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00832}{832}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00832                                               \{}
\DoxyCodeLine{00833   pthread\_mutex\_lock(\&s-\/>\mbox{\hyperlink{structsaurion_ad05334ffef73d89577b3bc60ecc11283}{status\_m}});}
\DoxyCodeLine{00834   \textcolor{keywordflow}{while} (s-\/>\mbox{\hyperlink{structsaurion_a342abf92b861ebc82e50349fe31246e2}{status}} == 1) \{}
\DoxyCodeLine{00835     pthread\_cond\_wait(\&s-\/>\mbox{\hyperlink{structsaurion_add5f25d5f709bda89fa5461eecdc2b2e}{status\_c}}, \&s-\/>\mbox{\hyperlink{structsaurion_ad05334ffef73d89577b3bc60ecc11283}{status\_m}});}
\DoxyCodeLine{00836   \}}
\DoxyCodeLine{00837   pthread\_mutex\_unlock(\&s-\/>\mbox{\hyperlink{structsaurion_ad05334ffef73d89577b3bc60ecc11283}{status\_m}});}
\DoxyCodeLine{00838   \mbox{\hyperlink{cthreadpool_8cpp_af203df90cae013853d5dde106517ae1d}{ThreadPool\_destroy}}(s-\/>\mbox{\hyperlink{structsaurion_aa6d22bb06ad66a5a860fcd642b4e7905}{pool}});}
\DoxyCodeLine{00839   \textcolor{keywordflow}{for} (uint32\_t i = 0; i < s-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}}; ++i) \{}
\DoxyCodeLine{00840     io\_uring\_queue\_exit(\&s-\/>\mbox{\hyperlink{structsaurion_a4858f070287e6269298089b993793830}{rings}}[i]);}
\DoxyCodeLine{00841     pthread\_mutex\_destroy(\&s-\/>\mbox{\hyperlink{structsaurion_ad3305571e32bbb72bc95caefbb68b030}{m\_rings}}[i]);}
\DoxyCodeLine{00842   \}}
\DoxyCodeLine{00843   free(s-\/>\mbox{\hyperlink{structsaurion_ad3305571e32bbb72bc95caefbb68b030}{m\_rings}});}
\DoxyCodeLine{00844   \mbox{\hyperlink{linked__list_8c_ac33c30e895caddc11181b50eca0ab735}{list\_free}}(\&s-\/>\mbox{\hyperlink{structsaurion_a63c38a9dc703180b628935d72236318f}{list}});}
\DoxyCodeLine{00845   \textcolor{keywordflow}{for} (uint32\_t i = 0; i < s-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}}; ++i) \{}
\DoxyCodeLine{00846     close(s-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}}[i]);}
\DoxyCodeLine{00847   \}}
\DoxyCodeLine{00848   free(s-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}});}
\DoxyCodeLine{00849   \textcolor{keywordflow}{if} (!s-\/>\mbox{\hyperlink{structsaurion_ae85c8eed456efd00dcc93d005b0ad99c}{ss}}) \{}
\DoxyCodeLine{00850     close(s-\/>\mbox{\hyperlink{structsaurion_ae85c8eed456efd00dcc93d005b0ad99c}{ss}});}
\DoxyCodeLine{00851   \}}
\DoxyCodeLine{00852   free(s-\/>\mbox{\hyperlink{structsaurion_a4858f070287e6269298089b993793830}{rings}});}
\DoxyCodeLine{00853   pthread\_mutex\_destroy(\&s-\/>\mbox{\hyperlink{structsaurion_ad05334ffef73d89577b3bc60ecc11283}{status\_m}});}
\DoxyCodeLine{00854   pthread\_cond\_destroy(\&s-\/>\mbox{\hyperlink{structsaurion_add5f25d5f709bda89fa5461eecdc2b2e}{status\_c}});}
\DoxyCodeLine{00855   free(s);}
\DoxyCodeLine{00856 \}}

\end{DoxyCode}
\mbox{\Hypertarget{group__LowSaurion_gadd63cf225e55bcf4cd22ddcbd9d1c9b7}\label{group__LowSaurion_gadd63cf225e55bcf4cd22ddcbd9d1c9b7}} 
\index{LowSaurion@{LowSaurion}!saurion\_send@{saurion\_send}}
\index{saurion\_send@{saurion\_send}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{saurion\_send()}{saurion\_send()}}
{\footnotesize\ttfamily void saurion\+\_\+send (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structsaurion}{saurion}} $\ast$}]{s,  }\item[{const int}]{fd,  }\item[{const char $\ast$const}]{msg }\end{DoxyParamCaption})}



Sends a message through a socket using io\+\_\+uring. 

This function prepares and sends a message through the specified socket using the io\+\_\+uring event queue. The message is split into iovec structures for efficient transmission and sent asynchronously.


\begin{DoxyParams}{Parameters}
{\em s} & Pointer to the {\ttfamily saurion} structure. \\
\hline
{\em fd} & File descriptor of the socket to which the message will be sent. \\
\hline
{\em msg} & Pointer to the character string (message) to be sent. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00858}{858}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00858                                                                                 \{}
\DoxyCodeLine{00859   \mbox{\hyperlink{low__saurion_8c_a39042ff39576b4db8db514acd6e9a224}{add\_write}}(s, fd, msg, \mbox{\hyperlink{low__saurion_8c_a7919e576d3fdccbefb75bee92abd5cc3}{next}}(s));}
\DoxyCodeLine{00860 \}}

\end{DoxyCode}
\mbox{\Hypertarget{group__LowSaurion_gaeeab8302b41112175566881a1b7bf905}\label{group__LowSaurion_gaeeab8302b41112175566881a1b7bf905}} 
\index{LowSaurion@{LowSaurion}!saurion\_start@{saurion\_start}}
\index{saurion\_start@{saurion\_start}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{saurion\_start()}{saurion\_start()}}
{\footnotesize\ttfamily int saurion\+\_\+start (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structsaurion}{saurion}} $\ast$}]{s }\end{DoxyParamCaption})}



Starts event processing in the {\ttfamily saurion} structure. 

This function begins accepting socket connections and handling io\+\_\+uring events in a loop. It will run continuously until a stop signal is received, allowing the application to manage multiple socket events asynchronously.


\begin{DoxyParams}{Parameters}
{\em s} & Pointer to the {\ttfamily saurion} structure. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int Returns 0 on success, or 1 if an error occurs. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00808}{808}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00808                                            \{}
\DoxyCodeLine{00809   pthread\_mutex\_init(\&\mbox{\hyperlink{low__saurion_8c_adcba6f6935d1807493e731cc5e79a661}{print\_mutex}}, NULL);}
\DoxyCodeLine{00810   \mbox{\hyperlink{cthreadpool_8cpp_a167313573a42e919a34b17a9cf533678}{ThreadPool\_init}}(s-\/>\mbox{\hyperlink{structsaurion_aa6d22bb06ad66a5a860fcd642b4e7905}{pool}});}
\DoxyCodeLine{00811   \mbox{\hyperlink{cthreadpool_8cpp_a29da21779e6052eb5dea1707ef6e8fa8}{ThreadPool\_add\_default}}(s-\/>\mbox{\hyperlink{structsaurion_aa6d22bb06ad66a5a860fcd642b4e7905}{pool}}, \mbox{\hyperlink{low__saurion_8c_a30bb7d15272a20fb689bf9fada1737fa}{saurion\_worker\_master}}, s);}
\DoxyCodeLine{00812   \textcolor{keyword}{struct }\mbox{\hyperlink{structsaurion__wrapper}{saurion\_wrapper}} *\mbox{\hyperlink{low__saurion_8h_a9a57016e056d7d2ce6d2417340c4429e}{ss}} = NULL;}
\DoxyCodeLine{00813   \textcolor{keywordflow}{for} (uint32\_t i = 1; i < \mbox{\hyperlink{structsaurion__wrapper_a56c88c88fc583f95d6f144ee3414458d}{s}}-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}}; ++i) \{}
\DoxyCodeLine{00814     \mbox{\hyperlink{low__saurion_8h_a9a57016e056d7d2ce6d2417340c4429e}{ss}} = (\textcolor{keyword}{struct }\mbox{\hyperlink{structsaurion__wrapper}{saurion\_wrapper}} *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \mbox{\hyperlink{structsaurion__wrapper}{saurion\_wrapper}}));}
\DoxyCodeLine{00815     \mbox{\hyperlink{low__saurion_8h_a9a57016e056d7d2ce6d2417340c4429e}{ss}}-\/>s = \mbox{\hyperlink{structsaurion__wrapper_a56c88c88fc583f95d6f144ee3414458d}{s}};}
\DoxyCodeLine{00816     \mbox{\hyperlink{low__saurion_8h_a9a57016e056d7d2ce6d2417340c4429e}{ss}}-\/>sel = i;}
\DoxyCodeLine{00817     \mbox{\hyperlink{cthreadpool_8cpp_a29da21779e6052eb5dea1707ef6e8fa8}{ThreadPool\_add\_default}}(\mbox{\hyperlink{structsaurion__wrapper_a56c88c88fc583f95d6f144ee3414458d}{s}}-\/>\mbox{\hyperlink{structsaurion_aa6d22bb06ad66a5a860fcd642b4e7905}{pool}}, \mbox{\hyperlink{low__saurion_8c_a70abc87ee43c0e1b7059ec16e975afca}{saurion\_worker\_slave}}, \mbox{\hyperlink{low__saurion_8h_a9a57016e056d7d2ce6d2417340c4429e}{ss}});}
\DoxyCodeLine{00818   \}}
\DoxyCodeLine{00819   \textcolor{keywordflow}{return} SUCCESS\_CODE;}
\DoxyCodeLine{00820 \}}

\end{DoxyCode}
\mbox{\Hypertarget{group__LowSaurion_ga9f32b41ec23178c2a693fec057b96532}\label{group__LowSaurion_ga9f32b41ec23178c2a693fec057b96532}} 
\index{LowSaurion@{LowSaurion}!saurion\_stop@{saurion\_stop}}
\index{saurion\_stop@{saurion\_stop}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{saurion\_stop()}{saurion\_stop()}}
{\footnotesize\ttfamily void saurion\+\_\+stop (\begin{DoxyParamCaption}\item[{const struct \mbox{\hyperlink{structsaurion}{saurion}} $\ast$}]{s }\end{DoxyParamCaption})}



Stops event processing in the {\ttfamily saurion} structure. 

This function sends a signal to the eventfd, indicating that the event loop should stop. It gracefully shuts down the processing of any remaining events before exiting.


\begin{DoxyParams}{Parameters}
{\em s} & Pointer to the {\ttfamily saurion} structure. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00822}{822}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00822                                                  \{}
\DoxyCodeLine{00823   uint64\_t u = 1;}
\DoxyCodeLine{00824   \textcolor{keywordflow}{for} (uint32\_t i = 0; i < s-\/>\mbox{\hyperlink{structsaurion_aee308efd9e70f3b38da24483a3f74413}{n\_threads}}; ++i) \{}
\DoxyCodeLine{00825     \textcolor{keywordflow}{while} (write(s-\/>\mbox{\hyperlink{structsaurion_a08e1b7aa083a0d311658ff7072ae7a46}{efds}}[i], \&u, \textcolor{keyword}{sizeof}(u)) < 0) \{}
\DoxyCodeLine{00826       usleep(TIMEOUT\_RETRY);}
\DoxyCodeLine{00827     \}}
\DoxyCodeLine{00828   \}}
\DoxyCodeLine{00829   \mbox{\hyperlink{cthreadpool_8cpp_a69d71a6f02edfe47deb07aedf33c9d90}{ThreadPool\_wait\_empty}}(s-\/>\mbox{\hyperlink{structsaurion_aa6d22bb06ad66a5a860fcd642b4e7905}{pool}});}
\DoxyCodeLine{00830 \}}

\end{DoxyCode}
\mbox{\Hypertarget{group__LowSaurion_gaddb696f3c38e160dde5a5de6e6e10f70}\label{group__LowSaurion_gaddb696f3c38e160dde5a5de6e6e10f70}} 
\index{LowSaurion@{LowSaurion}!set\_request@{set\_request}}
\index{set\_request@{set\_request}!LowSaurion@{LowSaurion}}
\doxysubsubsection{\texorpdfstring{set\_request()}{set\_request()}}
{\footnotesize\ttfamily int set\+\_\+request (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structrequest}{request}} $\ast$$\ast$}]{r,  }\item[{struct \mbox{\hyperlink{structNode}{Node}} $\ast$$\ast$}]{l,  }\item[{size\+\_\+t}]{s,  }\item[{const void $\ast$}]{m,  }\item[{uint8\+\_\+t}]{h }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Sets up a request and allocates iovec structures for data handling in liburing. 

This function configures a request structure that will be used to send or receive data through liburing\textquotesingle{}s submission queues. It allocates the necessary iovec structures to split the data into manageable chunks, and optionally adds a header if specified. The request is inserted into a list tracking active requests for proper memory management and deallocation upon completion.


\begin{DoxyParams}{Parameters}
{\em r} & Pointer to a pointer to the request structure. If NULL, a new request is created. \\
\hline
{\em l} & Pointer to the list of active requests (\mbox{\hyperlink{structNode}{Node}} list) where the request will be inserted. \\
\hline
{\em s} & Size of the data to be handled. Adjusted if the header flag (h) is true. \\
\hline
{\em m} & Pointer to the memory block containing the data to be processed. \\
\hline
{\em h} & Header flag. If true, a header (sizeof(uint64\+\_\+t) + 1) is added to the iovec data.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int Returns SUCCESS\+\_\+\+CODE on success, or ERROR\+\_\+\+CODE on failure (memory allocation issues or insertion failure). 
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em SUCCESS\+\_\+\+CODE} & The request was successfully set up and inserted into the list. \\
\hline
{\em ERROR\+\_\+\+CODE} & Memory allocation failed, or there was an error inserting the request into the list.\\
\hline
\end{DoxyRetVals}
\begin{DoxyNote}{Note}
The function handles memory allocation for the request and iovec structures, and ensures that the memory is freed properly if an error occurs. Pointers to the iovec blocks (children\+\_\+ptr) are managed and used for proper memory deallocation. 
\end{DoxyNote}


Definition at line \mbox{\hyperlink{low__saurion_8c_source_l00131}{131}} of file \mbox{\hyperlink{low__saurion_8c_source}{low\+\_\+saurion.\+c}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00131                                                                                          \{}
\DoxyCodeLine{00132   uint64\_t full\_size = s;}
\DoxyCodeLine{00133   \textcolor{keywordflow}{if} (h) \{}
\DoxyCodeLine{00134     full\_size += (\textcolor{keyword}{sizeof}(uint64\_t) + 1);}
\DoxyCodeLine{00135   \}}
\DoxyCodeLine{00136   \textcolor{keywordtype}{size\_t} amount = full\_size / CHUNK\_SZ;}
\DoxyCodeLine{00137   amount = amount + (full\_size \% CHUNK\_SZ == 0 ? 0 : 1);}
\DoxyCodeLine{00138   \textcolor{keyword}{struct }\mbox{\hyperlink{structrequest}{request}} *temp =}
\DoxyCodeLine{00139       (\textcolor{keyword}{struct }\mbox{\hyperlink{structrequest}{request}} *)malloc(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \mbox{\hyperlink{structrequest}{request}}) + \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }iovec) * amount);}
\DoxyCodeLine{00140   \textcolor{keywordflow}{if} (!temp) \{}
\DoxyCodeLine{00141     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00142   \}}
\DoxyCodeLine{00143   \textcolor{keywordflow}{if} (!*r) \{}
\DoxyCodeLine{00144     *r = temp;}
\DoxyCodeLine{00145     (*r)-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}} = NULL;}
\DoxyCodeLine{00146     (*r)-\/>prev\_size = 0;}
\DoxyCodeLine{00147     (*r)-\/>prev\_remain = 0;}
\DoxyCodeLine{00148     (*r)-\/>next\_iov = 0;}
\DoxyCodeLine{00149     (*r)-\/>next\_offset = 0;}
\DoxyCodeLine{00150   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00151     temp-\/>\mbox{\hyperlink{structrequest_a34dcdf74ea1d647ba95bcdd78c95c3b7}{client\_socket}} = (*r)-\/>client\_socket;}
\DoxyCodeLine{00152     temp-\/>\mbox{\hyperlink{structrequest_a9cba15f1748716ffe6869a271c1ccc4d}{event\_type}} = (*r)-\/>event\_type;}
\DoxyCodeLine{00153     temp-\/>\mbox{\hyperlink{structrequest_ab8f409ae411cecc817a691455830f700}{prev}} = (*r)-\/>prev;}
\DoxyCodeLine{00154     temp-\/>\mbox{\hyperlink{structrequest_a02dc8e759c5216e1b7f7c908a0e0481f}{prev\_size}} = (*r)-\/>prev\_size;}
\DoxyCodeLine{00155     temp-\/>\mbox{\hyperlink{structrequest_acb69c014fb67502b59cd112d3758569f}{prev\_remain}} = (*r)-\/>prev\_remain;}
\DoxyCodeLine{00156     temp-\/>\mbox{\hyperlink{structrequest_a4aba582d3fcf1110aa8f272d5b038a3d}{next\_iov}} = (*r)-\/>next\_iov;}
\DoxyCodeLine{00157     temp-\/>\mbox{\hyperlink{structrequest_a03abde14b48986b40d827b22e4ddfb2d}{next\_offset}} = (*r)-\/>next\_offset;}
\DoxyCodeLine{00158     *r = temp;}
\DoxyCodeLine{00159   \}}
\DoxyCodeLine{00160   \textcolor{keyword}{struct }\mbox{\hyperlink{structrequest}{request}} *req = *r;}
\DoxyCodeLine{00161   req-\/>\mbox{\hyperlink{structrequest_a1291bf32fbcafa3bb4b348578db09a9f}{iovec\_count}} = (int)amount;}
\DoxyCodeLine{00162   \textcolor{keywordtype}{void} **children\_ptr = (\textcolor{keywordtype}{void} **)malloc(amount * \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{void} *));}
\DoxyCodeLine{00163   \textcolor{keywordflow}{if} (!children\_ptr) \{}
\DoxyCodeLine{00164     \mbox{\hyperlink{group__LowSaurion_ga0f9760bc800b946244ccf790081e6bb3}{free\_request}}(req, children\_ptr, 0);}
\DoxyCodeLine{00165     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00166   \}}
\DoxyCodeLine{00167   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < amount; ++i) \{}
\DoxyCodeLine{00168     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group__LowSaurion_ga1c329b9155a9159b696b60247c9b328b}{allocate\_iovec}}(\&req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[i], amount, i, full\_size, children\_ptr)) \{}
\DoxyCodeLine{00169       \mbox{\hyperlink{group__LowSaurion_ga0f9760bc800b946244ccf790081e6bb3}{free\_request}}(req, children\_ptr, amount);}
\DoxyCodeLine{00170       \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00171     \}}
\DoxyCodeLine{00172     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{group__LowSaurion_gae64e81c0ce5f52d51684d8f1129e6076}{initialize\_iovec}}(\&req-\/>\mbox{\hyperlink{structrequest_ae23ac64f6ae30671afc753260ef411fd}{iov}}[i], amount, i, m, s, h)) \{}
\DoxyCodeLine{00173       \mbox{\hyperlink{group__LowSaurion_ga0f9760bc800b946244ccf790081e6bb3}{free\_request}}(req, children\_ptr, amount);}
\DoxyCodeLine{00174       \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00175     \}}
\DoxyCodeLine{00176   \}}
\DoxyCodeLine{00177   \textcolor{keywordflow}{if} (\mbox{\hyperlink{linked__list_8c_aee07283e23385804a1d3f880cd99731e}{list\_insert}}(l, req, amount, children\_ptr)) \{}
\DoxyCodeLine{00178     \mbox{\hyperlink{group__LowSaurion_ga0f9760bc800b946244ccf790081e6bb3}{free\_request}}(req, children\_ptr, amount);}
\DoxyCodeLine{00179     \textcolor{keywordflow}{return} ERROR\_CODE;}
\DoxyCodeLine{00180   \}}
\DoxyCodeLine{00181   free(children\_ptr);}
\DoxyCodeLine{00182   \textcolor{keywordflow}{return} SUCCESS\_CODE;}
\DoxyCodeLine{00183 \}}

\end{DoxyCode}
