<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Saurion: LowSaurion</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Saurion<span id="projectnumber">&#160;0.0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/da3/group__LowSaurion.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">LowSaurion</div></div>
</div><!--header-->
<div class="contents">

<p>The <code>saurion</code> class is designed to efficiently handle asynchronous input/output events on Linux systems using the <code>io_uring</code> API. Its main purpose is to manage network operations such as socket connections, reads, writes, and closures by leveraging an event-driven model that enhances performance and scalability in highly concurrent applications.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d32/structsaurion.html">saurion</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main structure for managing io_uring and socket events.  <a href="../../df/d32/structsaurion.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga7889939b2b6cdf65275305251f749af0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#ga7889939b2b6cdf65275305251f749af0">PACKING_SZ</a>&#160;&#160;&#160;128</td></tr>
<tr class="memdesc:ga7889939b2b6cdf65275305251f749af0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the memory alignment size for structures in the <code>saurion</code> class.  <a href="../../d9/da3/group__LowSaurion.html#ga7889939b2b6cdf65275305251f749af0">More...</a><br /></td></tr>
<tr class="separator:ga7889939b2b6cdf65275305251f749af0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga4a0bc8233ca030e29b9b94aed0177392"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#ga4a0bc8233ca030e29b9b94aed0177392">EXTERNAL_set_socket</a> (int p)</td></tr>
<tr class="separator:ga4a0bc8233ca030e29b9b94aed0177392"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae589ab08ed623ad2ab6d13beec33b131"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../df/d32/structsaurion.html">saurion</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#gae589ab08ed623ad2ab6d13beec33b131">saurion_create</a> (uint32_t <a class="el" href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a>)</td></tr>
<tr class="memdesc:gae589ab08ed623ad2ab6d13beec33b131"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates an instance of the <code>saurion</code> structure.  <a href="../../d9/da3/group__LowSaurion.html#gae589ab08ed623ad2ab6d13beec33b131">More...</a><br /></td></tr>
<tr class="separator:gae589ab08ed623ad2ab6d13beec33b131"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeeab8302b41112175566881a1b7bf905"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#gaeeab8302b41112175566881a1b7bf905">saurion_start</a> (struct <a class="el" href="../../df/d32/structsaurion.html">saurion</a> *s)</td></tr>
<tr class="memdesc:gaeeab8302b41112175566881a1b7bf905"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts event processing in the <code>saurion</code> structure.  <a href="../../d9/da3/group__LowSaurion.html#gaeeab8302b41112175566881a1b7bf905">More...</a><br /></td></tr>
<tr class="separator:gaeeab8302b41112175566881a1b7bf905"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9f32b41ec23178c2a693fec057b96532"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#ga9f32b41ec23178c2a693fec057b96532">saurion_stop</a> (const struct <a class="el" href="../../df/d32/structsaurion.html">saurion</a> *s)</td></tr>
<tr class="memdesc:ga9f32b41ec23178c2a693fec057b96532"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops event processing in the <code>saurion</code> structure.  <a href="../../d9/da3/group__LowSaurion.html#ga9f32b41ec23178c2a693fec057b96532">More...</a><br /></td></tr>
<tr class="separator:ga9f32b41ec23178c2a693fec057b96532"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7893ccf90a98845d5d95ffda0260d0b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#ga7893ccf90a98845d5d95ffda0260d0b8">saurion_destroy</a> (struct <a class="el" href="../../df/d32/structsaurion.html">saurion</a> *s)</td></tr>
<tr class="memdesc:ga7893ccf90a98845d5d95ffda0260d0b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroys the <code>saurion</code> structure and frees all associated resources.  <a href="../../d9/da3/group__LowSaurion.html#ga7893ccf90a98845d5d95ffda0260d0b8">More...</a><br /></td></tr>
<tr class="separator:ga7893ccf90a98845d5d95ffda0260d0b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadd63cf225e55bcf4cd22ddcbd9d1c9b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#gadd63cf225e55bcf4cd22ddcbd9d1c9b7">saurion_send</a> (struct <a class="el" href="../../df/d32/structsaurion.html">saurion</a> *s, const int fd, const char *const msg)</td></tr>
<tr class="memdesc:gadd63cf225e55bcf4cd22ddcbd9d1c9b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a message through a socket using io_uring.  <a href="../../d9/da3/group__LowSaurion.html#gadd63cf225e55bcf4cd22ddcbd9d1c9b7">More...</a><br /></td></tr>
<tr class="separator:gadd63cf225e55bcf4cd22ddcbd9d1c9b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1c329b9155a9159b696b60247c9b328b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#ga1c329b9155a9159b696b60247c9b328b">allocate_iovec</a> (struct iovec *iov, size_t amount, size_t pos, size_t size, void **chd_ptr)</td></tr>
<tr class="separator:ga1c329b9155a9159b696b60247c9b328b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae64e81c0ce5f52d51684d8f1129e6076"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#gae64e81c0ce5f52d51684d8f1129e6076">initialize_iovec</a> (struct iovec *iov, size_t amount, size_t pos, const void *msg, size_t size, uint8_t h)</td></tr>
<tr class="memdesc:gae64e81c0ce5f52d51684d8f1129e6076"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a specified <code>iovec</code> structure with a message fragment.  <a href="../../d9/da3/group__LowSaurion.html#gae64e81c0ce5f52d51684d8f1129e6076">More...</a><br /></td></tr>
<tr class="separator:gae64e81c0ce5f52d51684d8f1129e6076"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaddb696f3c38e160dde5a5de6e6e10f70"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#gaddb696f3c38e160dde5a5de6e6e10f70">set_request</a> (struct <a class="el" href="../../dc/d20/structrequest.html">request</a> **r, struct <a class="el" href="../../d8/d49/structNode.html">Node</a> **l, size_t s, const void *m, uint8_t h)</td></tr>
<tr class="memdesc:gaddb696f3c38e160dde5a5de6e6e10f70"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up a request and allocates iovec structures for data handling in liburing.  <a href="../../d9/da3/group__LowSaurion.html#gaddb696f3c38e160dde5a5de6e6e10f70">More...</a><br /></td></tr>
<tr class="separator:gaddb696f3c38e160dde5a5de6e6e10f70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaec24df6ee2f4999bf64acf5fc42ed019"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#gaec24df6ee2f4999bf64acf5fc42ed019">read_chunk</a> (void **dest, size_t *len, struct <a class="el" href="../../dc/d20/structrequest.html">request</a> *const req)</td></tr>
<tr class="memdesc:gaec24df6ee2f4999bf64acf5fc42ed019"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads a message chunk from the request's iovec buffers, handling messages that may span multiple iovec entries.  <a href="../../d9/da3/group__LowSaurion.html#gaec24df6ee2f4999bf64acf5fc42ed019">More...</a><br /></td></tr>
<tr class="separator:gaec24df6ee2f4999bf64acf5fc42ed019"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0f9760bc800b946244ccf790081e6bb3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/da3/group__LowSaurion.html#ga0f9760bc800b946244ccf790081e6bb3">free_request</a> (struct <a class="el" href="../../dc/d20/structrequest.html">request</a> *req, void **children_ptr, size_t amount)</td></tr>
<tr class="separator:ga0f9760bc800b946244ccf790081e6bb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >The <code>saurion</code> class is designed to efficiently handle asynchronous input/output events on Linux systems using the <code>io_uring</code> API. Its main purpose is to manage network operations such as socket connections, reads, writes, and closures by leveraging an event-driven model that enhances performance and scalability in highly concurrent applications. </p>
<p >This function allocates memory for each <code>struct iovec</code></p>
<p >The main structure, <code>saurion</code>, encapsulates <code>io_uring</code> rings and facilitates synchronization between multiple threads through the use of mutexes and a thread pool that distributes operations in parallel. This allows efficient handling of I/O operations across several sockets simultaneously, without blocking threads during operations.</p>
<p >The messages are composed of three main parts:</p><ul>
<li>A header, which is an unsigned 64-bit number representing the length of the message body.</li>
<li>A body, which contains the actual message data.</li>
<li>A footer, which consists of 8 bits set to 0.</li>
</ul>
<p >For example, for a message with 9000 bytes of content, the header would contain the number 9000, the body would consist of those 9000 bytes, and the footer would be 1 byte set to 0.</p>
<p >When these messages are sent to the kernel, they are divided into chunks using <code>iovec</code>. Each chunk can hold a maximum of 8192 bytes and contains two fields:</p><ul>
<li><code>iov_base</code>, which is an array where the chunk of the message is stored.</li>
<li><code>iov_len</code>, the number of bytes used in the <code>iov_base</code> array.</li>
</ul>
<p >For the message with 9000 bytes, the <code>iovec</code> division would look like this:</p>
<ul>
<li>The first <code>iovec</code> would contain:<ul>
<li>8 bytes for the header (the length of the message body, 9000).</li>
<li>8184 bytes of the message body.</li>
<li><code>iov_len</code> would be 8192 bytes in total.</li>
</ul>
</li>
<li>The second <code>iovec</code> would contain:<ul>
<li>The remaining 816 bytes of the message body.</li>
<li>1 byte for the footer (set to 0).</li>
<li><code>iov_len</code> would be 817 bytes in total.</li>
</ul>
</li>
</ul>
<p >The structure of the message is as follows: </p><pre class="fragment">  +------------------+--------------------+----------+
  |    Header        |       Body         |  Footer  |
  |  (64 bits: 9000) |   (Message Data)   | (1 byte) |
  +------------------+--------------------+----------+
</pre><p >The structure of the <code>iovec</code> division is:</p>
<pre class="fragment">  First iovec (8192 bytes):
  +-----------------------------------------+-----------------------+
  | iov_base                                | iov_len               |
  +-----------------------------------------+-----------------------+
  | 8 bytes header, 8184 bytes of message   | 8192                  |
  +-----------------------------------------+-----------------------+

  Second iovec (817 bytes):
  +-----------------------------------------+-----------------------+
  | iov_base                                | iov_len               |
  +-----------------------------------------+-----------------------+
  | 816 bytes of message, 1 byte footer (0) | 817                   |
  +-----------------------------------------+-----------------------+
</pre><p >Each I/O event can be monitored and managed through custom callbacks that handle connection, read, write, close, or error events on the sockets.</p>
<p >Basic usage example:</p>
<div class="fragment"><div class="line"><span class="comment">// Create the saurion structure with 4 threads</span></div>
<div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="../../df/d32/structsaurion.html">saurion</a> *s = <a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#gae589ab08ed623ad2ab6d13beec33b131">saurion_create</a>(4);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Start event processing</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#gaeeab8302b41112175566881a1b7bf905">saurion_start</a>(s) != 0) {</div>
<div class="line">    <span class="comment">// Handle the error</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Send a message through a socket</span></div>
<div class="line"><a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#gadd63cf225e55bcf4cd22ddcbd9d1c9b7">saurion_send</a>(s, socket_fd, <span class="stringliteral">&quot;Hello, World!&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Stop event processing</span></div>
<div class="line"><a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#ga9f32b41ec23178c2a693fec057b96532">saurion_stop</a>(s);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Destroy the structure and free resources</span></div>
<div class="line"><a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#ga7893ccf90a98845d5d95ffda0260d0b8">saurion_destroy</a>(s);</div>
<div class="ttc" id="agroup__LowSaurion_html_ga7893ccf90a98845d5d95ffda0260d0b8"><div class="ttname"><a href="../../d9/da3/group__LowSaurion.html#ga7893ccf90a98845d5d95ffda0260d0b8">saurion_destroy</a></div><div class="ttdeci">void saurion_destroy(struct saurion *const s)</div><div class="ttdoc">Destroys the saurion structure and frees all associated resources.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00832">low_saurion.c:832</a></div></div>
<div class="ttc" id="agroup__LowSaurion_html_ga9f32b41ec23178c2a693fec057b96532"><div class="ttname"><a href="../../d9/da3/group__LowSaurion.html#ga9f32b41ec23178c2a693fec057b96532">saurion_stop</a></div><div class="ttdeci">void saurion_stop(const struct saurion *const s)</div><div class="ttdoc">Stops event processing in the saurion structure.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00822">low_saurion.c:822</a></div></div>
<div class="ttc" id="agroup__LowSaurion_html_gadd63cf225e55bcf4cd22ddcbd9d1c9b7"><div class="ttname"><a href="../../d9/da3/group__LowSaurion.html#gadd63cf225e55bcf4cd22ddcbd9d1c9b7">saurion_send</a></div><div class="ttdeci">void saurion_send(struct saurion *const s, const int fd, const char *const msg)</div><div class="ttdoc">Sends a message through a socket using io_uring.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00858">low_saurion.c:858</a></div></div>
<div class="ttc" id="agroup__LowSaurion_html_gae589ab08ed623ad2ab6d13beec33b131"><div class="ttname"><a href="../../d9/da3/group__LowSaurion.html#gae589ab08ed623ad2ab6d13beec33b131">saurion_create</a></div><div class="ttdeci">struct saurion * saurion_create(uint32_t n_threads)</div><div class="ttdoc">Creates an instance of the saurion structure.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00585">low_saurion.c:585</a></div></div>
<div class="ttc" id="agroup__LowSaurion_html_gaeeab8302b41112175566881a1b7bf905"><div class="ttname"><a href="../../d9/da3/group__LowSaurion.html#gaeeab8302b41112175566881a1b7bf905">saurion_start</a></div><div class="ttdeci">int saurion_start(struct saurion *const s)</div><div class="ttdoc">Starts event processing in the saurion structure.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00808">low_saurion.c:808</a></div></div>
<div class="ttc" id="astructsaurion_html"><div class="ttname"><a href="../../df/d32/structsaurion.html">saurion</a></div><div class="ttdoc">Main structure for managing io_uring and socket events.</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00137">low_saurion.h:137</a></div></div>
</div><!-- fragment --><p >In this example, the <code>saurion</code> structure is created with 4 threads to handle the workload. Event processing is started, allowing it to accept connections and manage I/O operations on sockets. After sending a message through a socket, the system can be stopped, and the resources are freed.</p>
<dl class="section author"><dt>Author</dt><dd>Israel </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2024</dd></dl>
<p>This function allocates memory for each <code>struct iovec</code>. Every <code>struct iovec</code> consists of two member variables:</p><ul>
<li><code>iov_base</code>, a <code>void *</code> array that will hold the data. All of them will allocate the same amount of memory (CHUNK_SZ) to avoid memory fragmentation.</li>
<li><code>iov_len</code>, an integer representing the size of the data stored in the <code>iovec</code>. The data size is CHUNK_SZ unless it's the last one, in which case it will hold the remaining bytes. In addition to initialization, the function adds the pointers to the allocated memory into a child array to simplify memory deallocation later on.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">iov</td><td>Structure to initialize. </td></tr>
    <tr><td class="paramname">amount</td><td>Total number of <code>iovec</code> to initialize. </td></tr>
    <tr><td class="paramname">pos</td><td>Current position of the <code>iovec</code> within the total <code>iovec</code> (<code>amount</code>). </td></tr>
    <tr><td class="paramname">size</td><td>Total size of the data to be stored in the <code>iovec</code>. </td></tr>
    <tr><td class="paramname">chd_ptr</td><td>Array to hold the pointers to the allocated memory.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">ERROR_CODE</td><td>if there was an error during memory allocation. </td></tr>
    <tr><td class="paramname">SUCCESS_CODE</td><td>if the operation was successful.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The last <code>iovec</code> will allocate only the remaining bytes if the total size is not a multiple of CHUNK_SZ. </dd></dl>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga7889939b2b6cdf65275305251f749af0" name="ga7889939b2b6cdf65275305251f749af0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7889939b2b6cdf65275305251f749af0">&#9670;&nbsp;</a></span>PACKING_SZ</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PACKING_SZ&#160;&#160;&#160;128</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Defines the memory alignment size for structures in the <code>saurion</code> class. </p>
<p ><code>PACKING_SZ</code> is used to ensure that certain structures, such as <code><a class="el" href="../../d8/d5e/structsaurion__callbacks.html" title="Structure containing callback functions to handle socket events.">saurion_callbacks</a></code>, are aligned to a specific memory boundary. This can improve memory access performance and ensure compatibility with certain hardware architectures that require specific alignment.</p>
<p >In this case, the value is set to 128 bytes, meaning that structures marked with <code>__attribute__((aligned(PACKING_SZ)))</code> will be aligned to 128-byte boundaries.</p>
<p >Proper alignment can be particularly important in multithreaded environments or when working with low-level system APIs like <code>io_uring</code>, where unaligned memory accesses may introduce performance penalties.</p>
<p >Adjusting <code>PACKING_SZ</code> may be necessary depending on the hardware platform or specific performance requirements. </p>

<p class="definition">Definition at line <a class="el" href="../../d3/d68/low__saurion_8h_source.html#l00129">129</a> of file <a class="el" href="../../d3/d68/low__saurion_8h_source.html">low_saurion.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga1c329b9155a9159b696b60247c9b328b" name="ga1c329b9155a9159b696b60247c9b328b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1c329b9155a9159b696b60247c9b328b">&#9670;&nbsp;</a></span>allocate_iovec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int allocate_iovec </td>
          <td>(</td>
          <td class="paramtype">struct iovec *&#160;</td>
          <td class="paramname"><em>iov</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>amount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>chd_ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00114">114</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  114</span>                                                                                              {</div>
<div class="line"><span class="lineno">  115</span>  <span class="keywordflow">if</span> (!iov || !chd_ptr) {</div>
<div class="line"><span class="lineno">  116</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  117</span>  }</div>
<div class="line"><span class="lineno">  118</span>  iov-&gt;iov_base = malloc(CHUNK_SZ);</div>
<div class="line"><span class="lineno">  119</span>  <span class="keywordflow">if</span> (!iov-&gt;iov_base) {</div>
<div class="line"><span class="lineno">  120</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  121</span>  }</div>
<div class="line"><span class="lineno">  122</span>  iov-&gt;iov_len = (pos == (amount - 1) ? (size % CHUNK_SZ) : CHUNK_SZ);</div>
<div class="line"><span class="lineno">  123</span>  <span class="keywordflow">if</span> (iov-&gt;iov_len == 0) {</div>
<div class="line"><span class="lineno">  124</span>    iov-&gt;iov_len = CHUNK_SZ;</div>
<div class="line"><span class="lineno">  125</span>  }</div>
<div class="line"><span class="lineno">  126</span>  chd_ptr[pos] = iov-&gt;iov_base;</div>
<div class="line"><span class="lineno">  127</span>  <span class="keywordflow">return</span> SUCCESS_CODE;</div>
<div class="line"><span class="lineno">  128</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ga4a0bc8233ca030e29b9b94aed0177392" name="ga4a0bc8233ca030e29b9b94aed0177392"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4a0bc8233ca030e29b9b94aed0177392">&#9670;&nbsp;</a></span>EXTERNAL_set_socket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int EXTERNAL_set_socket </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000001">Todo:</a></b></dt><dd>Eliminar </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00548">548</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  548</span>                                     {</div>
<div class="line"><span class="lineno">  549</span>  <span class="keywordtype">int</span> sock = 0;</div>
<div class="line"><span class="lineno">  550</span>  <span class="keyword">struct </span>sockaddr_in srv_addr;</div>
<div class="line"><span class="lineno">  551</span> </div>
<div class="line"><span class="lineno">  552</span>  sock = socket(PF_INET, SOCK_STREAM, 0);</div>
<div class="line"><span class="lineno">  553</span>  <span class="keywordflow">if</span> (sock &lt; 1) {</div>
<div class="line"><span class="lineno">  554</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  555</span>  }</div>
<div class="line"><span class="lineno">  556</span> </div>
<div class="line"><span class="lineno">  557</span>  <span class="keywordtype">int</span> enable = 1;</div>
<div class="line"><span class="lineno">  558</span>  <span class="keywordflow">if</span> (setsockopt(sock, SOL_SOCKET, SO_REUSEADDR, &amp;enable, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)) &lt; 0) {</div>
<div class="line"><span class="lineno">  559</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  560</span>  }</div>
<div class="line"><span class="lineno">  561</span>  <span class="keywordflow">if</span> (setsockopt(sock, SOL_SOCKET, SO_REUSEPORT, &amp;enable, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)) &lt; 0) {</div>
<div class="line"><span class="lineno">  562</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  563</span>  }</div>
<div class="line"><span class="lineno">  564</span> </div>
<div class="line"><span class="lineno">  565</span>  memset(&amp;srv_addr, 0, <span class="keyword">sizeof</span>(srv_addr));</div>
<div class="line"><span class="lineno">  566</span>  srv_addr.sin_family = AF_INET;</div>
<div class="line"><span class="lineno">  567</span>  srv_addr.sin_port = htons(p);</div>
<div class="line"><span class="lineno">  568</span>  srv_addr.sin_addr.s_addr = htonl(INADDR_ANY);</div>
<div class="line"><span class="lineno">  569</span> </div>
<div class="line"><span class="lineno">  570</span>  <span class="comment">/* We bind to a port and turn this socket into a listening</span></div>
<div class="line"><span class="lineno">  571</span><span class="comment">   * socket.</span></div>
<div class="line"><span class="lineno">  572</span><span class="comment">   * */</span></div>
<div class="line"><span class="lineno">  573</span>  <span class="keywordflow">if</span> (bind(sock, (<span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *)&amp;srv_addr, <span class="keyword">sizeof</span>(srv_addr)) &lt; 0) {</div>
<div class="line"><span class="lineno">  574</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  575</span>  }</div>
<div class="line"><span class="lineno">  576</span> </div>
<div class="line"><span class="lineno">  577</span>  <span class="keywordflow">if</span> (listen(sock, ACCEPT_QUEUE) &lt; 0) {</div>
<div class="line"><span class="lineno">  578</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  579</span>  }</div>
<div class="line"><span class="lineno">  580</span> </div>
<div class="line"><span class="lineno">  581</span>  <span class="keywordflow">return</span> sock;</div>
<div class="line"><span class="lineno">  582</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ga0f9760bc800b946244ccf790081e6bb3" name="ga0f9760bc800b946244ccf790081e6bb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0f9760bc800b946244ccf790081e6bb3">&#9670;&nbsp;</a></span>free_request()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/d20/structrequest.html">request</a> *&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>children_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>amount</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00061">61</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   61</span>                                                                           {</div>
<div class="line"><span class="lineno">   62</span>  <span class="keywordflow">if</span> (children_ptr) {</div>
<div class="line"><span class="lineno">   63</span>    free(children_ptr);</div>
<div class="line"><span class="lineno">   64</span>    children_ptr = NULL;</div>
<div class="line"><span class="lineno">   65</span>  }</div>
<div class="line"><span class="lineno">   66</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; amount; ++i) {</div>
<div class="line"><span class="lineno">   67</span>    free(req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[i].iov_base);</div>
<div class="line"><span class="lineno">   68</span>    req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[i].iov_base = NULL;</div>
<div class="line"><span class="lineno">   69</span>  }</div>
<div class="line"><span class="lineno">   70</span>  free(req);</div>
<div class="line"><span class="lineno">   71</span>  req = NULL;</div>
<div class="line"><span class="lineno">   72</span>  free(children_ptr);</div>
<div class="line"><span class="lineno">   73</span>  children_ptr = NULL;</div>
<div class="line"><span class="lineno">   74</span>}</div>
<div class="ttc" id="astructrequest_html_ae23ac64f6ae30671afc753260ef411fd"><div class="ttname"><a href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">request::iov</a></div><div class="ttdeci">struct iovec iov[]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00024">low_saurion.c:24</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gae64e81c0ce5f52d51684d8f1129e6076" name="gae64e81c0ce5f52d51684d8f1129e6076"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae64e81c0ce5f52d51684d8f1129e6076">&#9670;&nbsp;</a></span>initialize_iovec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int initialize_iovec </td>
          <td>(</td>
          <td class="paramtype">struct iovec *&#160;</td>
          <td class="paramname"><em>iov</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>amount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>h</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initializes a specified <code>iovec</code> structure with a message fragment. </p>
<p >This function populates the <code>iov_base</code> of the <code>iovec</code> structure with a portion of the message, depending on the position (<code>pos</code>) in the overall set of iovec structures. The message is divided into chunks, and for the first <code>iovec</code>, a header containing the size of the message is included. Optionally, padding or adjustments can be applied based on the <code>h</code> flag.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">iov</td><td>Pointer to the <code>iovec</code> structure to initialize. </td></tr>
    <tr><td class="paramname">amount</td><td>The total number of <code>iovec</code> structures. </td></tr>
    <tr><td class="paramname">pos</td><td>The current position of the <code>iovec</code> within the overall message split. </td></tr>
    <tr><td class="paramname">msg</td><td>Pointer to the message to be split across the <code>iovec</code> structures. </td></tr>
    <tr><td class="paramname">size</td><td>The total size of the message. </td></tr>
    <tr><td class="paramname">h</td><td>A flag (header flag) that indicates whether special handling is needed for the first <code>iovec</code> (adds the message size as a header) or for the last chunk.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">SUCCESS_CODE</td><td>on successful initialization of the <code>iovec</code>. </td></tr>
    <tr><td class="paramname">ERROR_CODE</td><td>if the <code>iov</code> or its <code>iov_base</code> is null.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>For the first <code>iovec</code> (when <code>pos == 0</code>), the message size is copied into the beginning of the <code>iov_base</code> if the header flag (<code>h</code>) is set. Subsequent chunks are filled with message data, and the last chunk may have one byte reduced if <code>h</code> is set.</dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>The message must be properly aligned and divided, especially when using the header flag to ensure no memory access issues.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>If <code>msg</code> is null, the function will initialize the <code>iov_base</code> with zeros, essentially resetting the buffer. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00077">77</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   78</span>                                {</div>
<div class="line"><span class="lineno">   79</span>  <span class="keywordflow">if</span> (!iov || !iov-&gt;iov_base) {</div>
<div class="line"><span class="lineno">   80</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">   81</span>  }</div>
<div class="line"><span class="lineno">   82</span>  <span class="keywordflow">if</span> (msg) {</div>
<div class="line"><span class="lineno">   83</span>    <span class="keywordtype">size_t</span> len = iov-&gt;iov_len;</div>
<div class="line"><span class="lineno">   84</span>    <span class="keywordtype">char</span> *dest = (<span class="keywordtype">char</span> *)iov-&gt;iov_base;</div>
<div class="line"><span class="lineno">   85</span>    <span class="keywordtype">char</span> *orig = (<span class="keywordtype">char</span> *)msg + pos * CHUNK_SZ;</div>
<div class="line"><span class="lineno">   86</span>    <span class="keywordtype">size_t</span> cpy_sz = 0;</div>
<div class="line"><span class="lineno">   87</span>    <span class="keywordflow">if</span> (h) {</div>
<div class="line"><span class="lineno">   88</span>      <span class="keywordflow">if</span> (pos == 0) {</div>
<div class="line"><span class="lineno">   89</span>        uint64_t send_size = <a class="code hl_function" href="../../de/d27/low__saurion_8c.html#a00d80bc019becac44a598996923faecf">htonll</a>(size);</div>
<div class="line"><span class="lineno">   90</span>        memcpy(dest, &amp;send_size, <span class="keyword">sizeof</span>(uint64_t));</div>
<div class="line"><span class="lineno">   91</span>        dest += <span class="keyword">sizeof</span>(uint64_t);</div>
<div class="line"><span class="lineno">   92</span>        len -= <span class="keyword">sizeof</span>(uint64_t);</div>
<div class="line"><span class="lineno">   93</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   94</span>        orig -= <span class="keyword">sizeof</span>(uint64_t);</div>
<div class="line"><span class="lineno">   95</span>      }</div>
<div class="line"><span class="lineno">   96</span>      <span class="keywordflow">if</span> ((pos + 1) == amount) {</div>
<div class="line"><span class="lineno">   97</span>        --len;</div>
<div class="line"><span class="lineno">   98</span>        cpy_sz = (len &lt; size ? len : size);</div>
<div class="line"><span class="lineno">   99</span>        dest[cpy_sz] = 0;</div>
<div class="line"><span class="lineno">  100</span>      }</div>
<div class="line"><span class="lineno">  101</span>    }</div>
<div class="line"><span class="lineno">  102</span>    cpy_sz = (len &lt; size ? len : size);</div>
<div class="line"><span class="lineno">  103</span>    memcpy(dest, orig, cpy_sz);</div>
<div class="line"><span class="lineno">  104</span>    dest += cpy_sz;</div>
<div class="line"><span class="lineno">  105</span>    <span class="keywordtype">size_t</span> rem = CHUNK_SZ - (dest - (<span class="keywordtype">char</span> *)iov-&gt;iov_base);</div>
<div class="line"><span class="lineno">  106</span>    memset(dest, 0, rem);</div>
<div class="line"><span class="lineno">  107</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  108</span>    memset((<span class="keywordtype">char</span> *)iov-&gt;iov_base, 0, CHUNK_SZ);</div>
<div class="line"><span class="lineno">  109</span>  }</div>
<div class="line"><span class="lineno">  110</span>  <span class="keywordflow">return</span> SUCCESS_CODE;</div>
<div class="line"><span class="lineno">  111</span>}</div>
<div class="ttc" id="alow__saurion_8c_html_a00d80bc019becac44a598996923faecf"><div class="ttname"><a href="../../de/d27/low__saurion_8c.html#a00d80bc019becac44a598996923faecf">htonll</a></div><div class="ttdeci">static uint64_t htonll(uint64_t value)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00041">low_saurion.c:41</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gaec24df6ee2f4999bf64acf5fc42ed019" name="gaec24df6ee2f4999bf64acf5fc42ed019"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaec24df6ee2f4999bf64acf5fc42ed019">&#9670;&nbsp;</a></span>read_chunk()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int read_chunk </td>
          <td>(</td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dc/d20/structrequest.html">request</a> *const&#160;</td>
          <td class="paramname"><em>req</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reads a message chunk from the request's iovec buffers, handling messages that may span multiple iovec entries. </p>
<p >This function processes data from a <code>struct request</code>, which contains an array of <code>iovec</code> structures representing buffered data. Each message in the buffers starts with a <code>size_t</code> value indicating the size of the message, followed by the message content. The function reads the message size, allocates a buffer for the message content, and copies the data from the iovec buffers into this buffer. It handles messages that span multiple iovec entries and manages incomplete messages by storing partial data within the request structure for subsequent reads.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">dest</td><td>Pointer to a variable where the address of the allocated message buffer will be stored. The buffer is allocated by the function and must be freed by the caller. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">len</td><td>Pointer to a <code>size_t</code> variable where the length of the read message will be stored. If a complete message is read, <code>*len</code> is set to the message size. If the message is incomplete, <code>*len</code> is set to 0. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">req</td><td>Pointer to a <code>struct request</code> containing the iovec buffers and state information. The function updates the request's state to track the current position within the iovecs and any incomplete messages.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The function assumes that each message is prefixed with its size (of type <code>size_t</code>), and that messages may span multiple iovec entries. It also assumes that the data in the iovec buffers is valid and properly aligned for reading <code>size_t</code> values.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The caller is responsible for freeing the allocated message buffer pointed to by <code>*dest</code> when it is no longer needed.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns SUCCESS_CODE on success, or ERROR_CODE on failure (malformed msg). </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">SUCCESS_CODE</td><td>No malformed message found. </td></tr>
    <tr><td class="paramname">ERROR_CODE</td><td>Malformed message found. </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="../../dd/da0/todo.html#_todo000002">Todo:</a></b></dt><dd><p class="startdd">add message contraint </p>
<p class="interdd">validar <code>msg_size</code>, crear maximos </p>
<p class="enddd">validar <code>offsets</code> </p>
</dd></dl>
<p >Remaining bytes of the message (content + header + foot) stored in the current IOVEC</p>

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00350">350</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  350</span>                                                                    {</div>
<div class="line"><span class="lineno">  351</span>  <span class="comment">// Initial checks</span></div>
<div class="line"><span class="lineno">  352</span>  <span class="keywordflow">if</span> (req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a1291bf32fbcafa3bb4b348578db09a9f">iovec_count</a> == 0) {</div>
<div class="line"><span class="lineno">  353</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  354</span>  }</div>
<div class="line"><span class="lineno">  355</span> </div>
<div class="line"><span class="lineno">  356</span>  <span class="comment">// Initizalization</span></div>
<div class="line"><span class="lineno">  357</span>  <span class="keywordtype">size_t</span> max_iov_cont = 0;  <span class="comment">//&lt; Total size of request</span></div>
<div class="line"><span class="lineno">  358</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a1291bf32fbcafa3bb4b348578db09a9f">iovec_count</a>; ++i) {</div>
<div class="line"><span class="lineno">  359</span>    max_iov_cont += req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[i].iov_len;</div>
<div class="line"><span class="lineno">  360</span>  }</div>
<div class="line"><span class="lineno">  361</span>  <span class="keywordtype">size_t</span> cont_sz = 0;       <span class="comment">//&lt; Message content size</span></div>
<div class="line"><span class="lineno">  362</span>  <span class="keywordtype">size_t</span> cont_rem = 0;      <span class="comment">//&lt; Remaining bytes of message content</span></div>
<div class="line"><span class="lineno">  363</span>  <span class="keywordtype">size_t</span> curr_iov = 0;      <span class="comment">//&lt; IOVEC num currently reading</span></div>
<div class="line"><span class="lineno">  364</span>  <span class="keywordtype">size_t</span> curr_iov_off = 0;  <span class="comment">//&lt; Offset in bytes of the current IOVEC</span></div>
<div class="line"><span class="lineno">  365</span>  <span class="keywordtype">size_t</span> dest_off = 0;      <span class="comment">//&lt; Write offset on the destiny array</span></div>
<div class="line"><span class="lineno">  366</span>  <span class="keywordtype">void</span> *dest_ptr = NULL;    <span class="comment">//&lt; Destiny pointer, could be dest or prev</span></div>
<div class="line"><span class="lineno">  367</span>  <span class="keywordflow">if</span> (req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a> &amp;&amp; req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a02dc8e759c5216e1b7f7c908a0e0481f">prev_size</a> &amp;&amp; req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#acb69c014fb67502b59cd112d3758569f">prev_remain</a>) {</div>
<div class="line"><span class="lineno">  368</span>    <span class="comment">// There&#39;s a previous unfinished message</span></div>
<div class="line"><span class="lineno">  369</span>    cont_sz = req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a02dc8e759c5216e1b7f7c908a0e0481f">prev_size</a>;</div>
<div class="line"><span class="lineno">  370</span>    cont_rem = req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#acb69c014fb67502b59cd112d3758569f">prev_remain</a>;</div>
<div class="line"><span class="lineno">  371</span>    curr_iov = 0;</div>
<div class="line"><span class="lineno">  372</span>    curr_iov_off = 0;</div>
<div class="line"><span class="lineno">  373</span>    dest_off = cont_sz - cont_rem;</div>
<div class="line"><span class="lineno">  374</span>    <span class="keywordflow">if</span> (cont_rem &lt;= max_iov_cont) {</div>
<div class="line"><span class="lineno">  375</span>      *dest = req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a>;</div>
<div class="line"><span class="lineno">  376</span>      dest_ptr = *dest;</div>
<div class="line"><span class="lineno">  377</span>      req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a> = NULL;</div>
<div class="line"><span class="lineno">  378</span>      req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a02dc8e759c5216e1b7f7c908a0e0481f">prev_size</a> = 0;</div>
<div class="line"><span class="lineno">  379</span>      req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#acb69c014fb67502b59cd112d3758569f">prev_remain</a> = 0;</div>
<div class="line"><span class="lineno">  380</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  381</span>      dest_ptr = req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a>;</div>
<div class="line"><span class="lineno">  382</span>      *dest = NULL;</div>
<div class="line"><span class="lineno">  383</span>    }</div>
<div class="line"><span class="lineno">  384</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a4aba582d3fcf1110aa8f272d5b038a3d">next_iov</a> || req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a03abde14b48986b40d827b22e4ddfb2d">next_offset</a>) {</div>
<div class="line"><span class="lineno">  385</span>    <span class="comment">// Reading the next message</span></div>
<div class="line"><span class="lineno">  386</span>    curr_iov = req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a4aba582d3fcf1110aa8f272d5b038a3d">next_iov</a>;</div>
<div class="line"><span class="lineno">  387</span>    curr_iov_off = req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a03abde14b48986b40d827b22e4ddfb2d">next_offset</a>;</div>
<div class="line"><span class="lineno">  388</span>    cont_sz = *((<span class="keywordtype">size_t</span> *)(req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[curr_iov].iov_base + curr_iov_off));</div>
<div class="line"><span class="lineno">  389</span>    cont_sz = <a class="code hl_function" href="../../de/d27/low__saurion_8c.html#a5fae4cad12b0ca469184e097624aea08">ntohll</a>(cont_sz);</div>
<div class="line"><span class="lineno">  390</span>    curr_iov_off += <span class="keyword">sizeof</span>(uint64_t);</div>
<div class="line"><span class="lineno">  391</span>    cont_rem = cont_sz;</div>
<div class="line"><span class="lineno">  392</span>    dest_off = cont_sz - cont_rem;</div>
<div class="line"><span class="lineno">  393</span>    <span class="keywordflow">if</span> ((curr_iov_off + cont_rem + 1) &lt;= max_iov_cont) {</div>
<div class="line"><span class="lineno">  394</span>      *dest = malloc(cont_sz);</div>
<div class="line"><span class="lineno">  395</span>      dest_ptr = *dest;</div>
<div class="line"><span class="lineno">  396</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  397</span>      req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a> = malloc(cont_sz);</div>
<div class="line"><span class="lineno">  398</span>      dest_ptr = req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a>;</div>
<div class="line"><span class="lineno">  399</span>      *dest = NULL;</div>
<div class="line"><span class="lineno">  400</span>      *len = 0;</div>
<div class="line"><span class="lineno">  401</span>    }</div>
<div class="line"><span class="lineno">  402</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  403</span>    <span class="comment">// Reading the first message</span></div>
<div class="line"><span class="lineno">  404</span>    curr_iov = 0;</div>
<div class="line"><span class="lineno">  405</span>    curr_iov_off = 0;</div>
<div class="line"><span class="lineno">  406</span>    cont_sz = *((<span class="keywordtype">size_t</span> *)(req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[curr_iov].iov_base + curr_iov_off));</div>
<div class="line"><span class="lineno">  407</span>    cont_sz = <a class="code hl_function" href="../../de/d27/low__saurion_8c.html#a5fae4cad12b0ca469184e097624aea08">ntohll</a>(cont_sz);</div>
<div class="line"><span class="lineno">  408</span>    curr_iov_off += <span class="keyword">sizeof</span>(uint64_t);</div>
<div class="line"><span class="lineno">  409</span>    cont_rem = cont_sz;</div>
<div class="line"><span class="lineno">  410</span>    dest_off = cont_sz - cont_rem;</div>
<div class="line"><span class="lineno">  411</span>    <span class="keywordflow">if</span> (cont_rem &lt;= max_iov_cont) {</div>
<div class="line"><span class="lineno">  412</span>      *dest = malloc(cont_sz);</div>
<div class="line"><span class="lineno">  413</span>      dest_ptr = *dest;</div>
<div class="line"><span class="lineno">  414</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  415</span>      req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a> = malloc(cont_sz);</div>
<div class="line"><span class="lineno">  416</span>      dest_ptr = req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a>;</div>
<div class="line"><span class="lineno">  417</span>      *dest = NULL;</div>
<div class="line"><span class="lineno">  418</span>    }</div>
<div class="line"><span class="lineno">  419</span>  }</div>
<div class="line"><span class="lineno">  421</span>  <span class="keywordtype">size_t</span> curr_iov_msg_rem = 0;</div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>  <span class="comment">// Copy loop</span></div>
<div class="line"><span class="lineno">  424</span>  uint8_t ok = 1UL;</div>
<div class="line"><span class="lineno">  425</span>  <span class="keywordflow">while</span> (1) {</div>
<div class="line"><span class="lineno">  426</span>    curr_iov_msg_rem = <a class="code hl_define" href="../../de/d27/low__saurion_8c.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(cont_rem, (req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[curr_iov].iov_len - curr_iov_off));</div>
<div class="line"><span class="lineno">  427</span>    memcpy(dest_ptr + dest_off, req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[curr_iov].iov_base + curr_iov_off, curr_iov_msg_rem);</div>
<div class="line"><span class="lineno">  428</span>    dest_off += curr_iov_msg_rem;</div>
<div class="line"><span class="lineno">  429</span>    curr_iov_off += curr_iov_msg_rem;</div>
<div class="line"><span class="lineno">  430</span>    cont_rem -= curr_iov_msg_rem;</div>
<div class="line"><span class="lineno">  431</span>    <span class="keywordflow">if</span> (cont_rem &lt;= 0) {</div>
<div class="line"><span class="lineno">  432</span>      <span class="comment">// Finish reading</span></div>
<div class="line"><span class="lineno">  433</span>      <span class="keywordflow">if</span> (*((uint8_t *)(req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[curr_iov].iov_base + curr_iov_off)) != 0) {</div>
<div class="line"><span class="lineno">  434</span>        ok = 0UL;</div>
<div class="line"><span class="lineno">  435</span>      }</div>
<div class="line"><span class="lineno">  436</span>      *len = cont_sz;</div>
<div class="line"><span class="lineno">  437</span>      ++curr_iov_off;</div>
<div class="line"><span class="lineno">  438</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  439</span>    }</div>
<div class="line"><span class="lineno">  440</span>    <span class="keywordflow">if</span> (curr_iov_off &gt;= (req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[curr_iov].iov_len)) {</div>
<div class="line"><span class="lineno">  441</span>      ++curr_iov;</div>
<div class="line"><span class="lineno">  442</span>      <span class="keywordflow">if</span> (curr_iov == req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a1291bf32fbcafa3bb4b348578db09a9f">iovec_count</a>) {</div>
<div class="line"><span class="lineno">  443</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  444</span>      }</div>
<div class="line"><span class="lineno">  445</span>      curr_iov_off = 0;</div>
<div class="line"><span class="lineno">  446</span>    }</div>
<div class="line"><span class="lineno">  447</span>  }</div>
<div class="line"><span class="lineno">  448</span> </div>
<div class="line"><span class="lineno">  449</span>  <span class="comment">// Update status</span></div>
<div class="line"><span class="lineno">  450</span>  <span class="keywordflow">if</span> (req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a>) {</div>
<div class="line"><span class="lineno">  451</span>    req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a02dc8e759c5216e1b7f7c908a0e0481f">prev_size</a> = cont_sz;</div>
<div class="line"><span class="lineno">  452</span>    req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#acb69c014fb67502b59cd112d3758569f">prev_remain</a> = cont_rem;</div>
<div class="line"><span class="lineno">  453</span>    *dest = NULL;</div>
<div class="line"><span class="lineno">  454</span>    len = 0;</div>
<div class="line"><span class="lineno">  455</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  456</span>    req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a02dc8e759c5216e1b7f7c908a0e0481f">prev_size</a> = 0;</div>
<div class="line"><span class="lineno">  457</span>    req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#acb69c014fb67502b59cd112d3758569f">prev_remain</a> = 0;</div>
<div class="line"><span class="lineno">  458</span>  }</div>
<div class="line"><span class="lineno">  459</span>  <span class="keywordflow">if</span> (curr_iov &lt; req-&gt;iovec_count) {</div>
<div class="line"><span class="lineno">  460</span>    uint64_t next_sz = *(uint64_t *)(req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[curr_iov].iov_base + curr_iov_off);</div>
<div class="line"><span class="lineno">  461</span>    <span class="keywordflow">if</span> ((req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[curr_iov].iov_len &gt; curr_iov_off) &amp;&amp; next_sz) {</div>
<div class="line"><span class="lineno">  462</span>      req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a4aba582d3fcf1110aa8f272d5b038a3d">next_iov</a> = curr_iov;</div>
<div class="line"><span class="lineno">  463</span>      req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a03abde14b48986b40d827b22e4ddfb2d">next_offset</a> = curr_iov_off;</div>
<div class="line"><span class="lineno">  464</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  465</span>      req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a4aba582d3fcf1110aa8f272d5b038a3d">next_iov</a> = 0;</div>
<div class="line"><span class="lineno">  466</span>      req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a03abde14b48986b40d827b22e4ddfb2d">next_offset</a> = 0;</div>
<div class="line"><span class="lineno">  467</span>    }</div>
<div class="line"><span class="lineno">  468</span>  }</div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>  <span class="comment">// Finish</span></div>
<div class="line"><span class="lineno">  471</span>  <span class="keywordflow">if</span> (!ok) {</div>
<div class="line"><span class="lineno">  472</span>    <span class="comment">// Esto solo es posible si no se encuentra un 0 al final del la lectura</span></div>
<div class="line"><span class="lineno">  473</span>    <span class="comment">// buscar el siguiente 0 y ... probar fortuna</span></div>
<div class="line"><span class="lineno">  474</span>    free(dest_ptr);</div>
<div class="line"><span class="lineno">  475</span>    dest_ptr = NULL;</div>
<div class="line"><span class="lineno">  476</span>    *dest = NULL;</div>
<div class="line"><span class="lineno">  477</span>    *len = 0;</div>
<div class="line"><span class="lineno">  478</span>    req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a4aba582d3fcf1110aa8f272d5b038a3d">next_iov</a> = 0;</div>
<div class="line"><span class="lineno">  479</span>    req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a03abde14b48986b40d827b22e4ddfb2d">next_offset</a> = 0;</div>
<div class="line"><span class="lineno">  480</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = curr_iov; i &lt; req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a1291bf32fbcafa3bb4b348578db09a9f">iovec_count</a>; ++i) {</div>
<div class="line"><span class="lineno">  481</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = curr_iov_off; j &lt; req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[i].iov_len; ++j) {</div>
<div class="line"><span class="lineno">  482</span>        uint8_t foot = *(uint8_t *)(req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[i].iov_base + j);</div>
<div class="line"><span class="lineno">  483</span>        <span class="keywordflow">if</span> (foot == 0) {</div>
<div class="line"><span class="lineno">  484</span>          req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a4aba582d3fcf1110aa8f272d5b038a3d">next_iov</a> = i;</div>
<div class="line"><span class="lineno">  485</span>          req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a03abde14b48986b40d827b22e4ddfb2d">next_offset</a> = (j + 1) % req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[i].iov_len;</div>
<div class="line"><span class="lineno">  486</span>          <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  487</span>        }</div>
<div class="line"><span class="lineno">  488</span>      }</div>
<div class="line"><span class="lineno">  489</span>    }</div>
<div class="line"><span class="lineno">  490</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  491</span>  }</div>
<div class="line"><span class="lineno">  492</span>  <span class="keywordflow">return</span> SUCCESS_CODE;</div>
<div class="line"><span class="lineno">  493</span>}</div>
<div class="ttc" id="alow__saurion_8c_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="../../de/d27/low__saurion_8c.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00027">low_saurion.c:27</a></div></div>
<div class="ttc" id="alow__saurion_8c_html_a5fae4cad12b0ca469184e097624aea08"><div class="ttname"><a href="../../de/d27/low__saurion_8c.html#a5fae4cad12b0ca469184e097624aea08">ntohll</a></div><div class="ttdeci">static uint64_t ntohll(uint64_t value)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00051">low_saurion.c:51</a></div></div>
<div class="ttc" id="astructrequest_html_a02dc8e759c5216e1b7f7c908a0e0481f"><div class="ttname"><a href="../../dc/d20/structrequest.html#a02dc8e759c5216e1b7f7c908a0e0481f">request::prev_size</a></div><div class="ttdeci">size_t prev_size</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00017">low_saurion.c:17</a></div></div>
<div class="ttc" id="astructrequest_html_a03abde14b48986b40d827b22e4ddfb2d"><div class="ttname"><a href="../../dc/d20/structrequest.html#a03abde14b48986b40d827b22e4ddfb2d">request::next_offset</a></div><div class="ttdeci">size_t next_offset</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00020">low_saurion.c:20</a></div></div>
<div class="ttc" id="astructrequest_html_a1291bf32fbcafa3bb4b348578db09a9f"><div class="ttname"><a href="../../dc/d20/structrequest.html#a1291bf32fbcafa3bb4b348578db09a9f">request::iovec_count</a></div><div class="ttdeci">size_t iovec_count</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00022">low_saurion.c:22</a></div></div>
<div class="ttc" id="astructrequest_html_a4aba582d3fcf1110aa8f272d5b038a3d"><div class="ttname"><a href="../../dc/d20/structrequest.html#a4aba582d3fcf1110aa8f272d5b038a3d">request::next_iov</a></div><div class="ttdeci">size_t next_iov</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00019">low_saurion.c:19</a></div></div>
<div class="ttc" id="astructrequest_html_ab8f409ae411cecc817a691455830f700"><div class="ttname"><a href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">request::prev</a></div><div class="ttdeci">void * prev</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00016">low_saurion.c:16</a></div></div>
<div class="ttc" id="astructrequest_html_acb69c014fb67502b59cd112d3758569f"><div class="ttname"><a href="../../dc/d20/structrequest.html#acb69c014fb67502b59cd112d3758569f">request::prev_remain</a></div><div class="ttdeci">size_t prev_remain</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00018">low_saurion.c:18</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gae589ab08ed623ad2ab6d13beec33b131" name="gae589ab08ed623ad2ab6d13beec33b131"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae589ab08ed623ad2ab6d13beec33b131">&#9670;&nbsp;</a></span>saurion_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../df/d32/structsaurion.html">saurion</a> * saurion_create </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>n_threads</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates an instance of the <code>saurion</code> structure. </p>
<p >This function initializes the <code>saurion</code> structure, sets up the eventfd, and configures the io_uring queue, preparing it for use. It also sets up the thread pool and any necessary synchronization mechanisms.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">n_threads</td><td>The number of threads to initialize in the thread pool. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>struct saurion* A pointer to the newly created <code>saurion</code> structure, or NULL if an error occurs. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00585">585</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  585</span>                                                   {</div>
<div class="line"><span class="lineno">  586</span>  <span class="comment">// Asignar memoria</span></div>
<div class="line"><span class="lineno">  587</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../df/d32/structsaurion.html">saurion</a> *p = (<span class="keyword">struct </span><a class="code hl_struct" href="../../df/d32/structsaurion.html">saurion</a> *)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="../../df/d32/structsaurion.html">saurion</a>));</div>
<div class="line"><span class="lineno">  588</span>  <span class="keywordflow">if</span> (!p) {</div>
<div class="line"><span class="lineno">  589</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  590</span>  }</div>
<div class="line"><span class="lineno">  591</span>  <span class="comment">// Inicializar mutex</span></div>
<div class="line"><span class="lineno">  592</span>  <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"><span class="lineno">  593</span>  ret = pthread_mutex_init(&amp;p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad05334ffef73d89577b3bc60ecc11283">status_m</a>, NULL);</div>
<div class="line"><span class="lineno">  594</span>  <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><span class="lineno">  595</span>    free(p);</div>
<div class="line"><span class="lineno">  596</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  597</span>  }</div>
<div class="line"><span class="lineno">  598</span>  ret = pthread_cond_init(&amp;p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#add5f25d5f709bda89fa5461eecdc2b2e">status_c</a>, NULL);</div>
<div class="line"><span class="lineno">  599</span>  <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><span class="lineno">  600</span>    free(p);</div>
<div class="line"><span class="lineno">  601</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  602</span>  }</div>
<div class="line"><span class="lineno">  603</span>  p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad3305571e32bbb72bc95caefbb68b030">m_rings</a> = (pthread_mutex_t *)malloc(<a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a> * <span class="keyword">sizeof</span>(pthread_mutex_t));</div>
<div class="line"><span class="lineno">  604</span>  <span class="keywordflow">if</span> (!p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad3305571e32bbb72bc95caefbb68b030">m_rings</a>) {</div>
<div class="line"><span class="lineno">  605</span>    free(p);</div>
<div class="line"><span class="lineno">  606</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  607</span>  }</div>
<div class="line"><span class="lineno">  608</span>  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; <a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a>; ++i) {</div>
<div class="line"><span class="lineno">  609</span>    pthread_mutex_init(&amp;(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad3305571e32bbb72bc95caefbb68b030">m_rings</a>[i]), NULL);</div>
<div class="line"><span class="lineno">  610</span>  }</div>
<div class="line"><span class="lineno">  611</span>  <span class="comment">// Inicializar miembros</span></div>
<div class="line"><span class="lineno">  612</span>  p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ae85c8eed456efd00dcc93d005b0ad99c">ss</a> = 0;</div>
<div class="line"><span class="lineno">  613</span>  <a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a> = (<a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a> &lt; 2 ? 2 : <a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a>);</div>
<div class="line"><span class="lineno">  614</span>  <a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a> = (<a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a> &gt; NUM_CORES ? NUM_CORES : <a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a>);</div>
<div class="line"><span class="lineno">  615</span>  p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a> = <a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a>;</div>
<div class="line"><span class="lineno">  616</span>  p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a342abf92b861ebc82e50349fe31246e2">status</a> = 0;</div>
<div class="line"><span class="lineno">  617</span>  p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a63c38a9dc703180b628935d72236318f">list</a> = NULL;</div>
<div class="line"><span class="lineno">  618</span>  p-&gt;cb.on_connected = NULL;</div>
<div class="line"><span class="lineno">  619</span>  p-&gt;cb.on_connected_arg = NULL;</div>
<div class="line"><span class="lineno">  620</span>  p-&gt;cb.on_readed = NULL;</div>
<div class="line"><span class="lineno">  621</span>  p-&gt;cb.on_readed_arg = NULL;</div>
<div class="line"><span class="lineno">  622</span>  p-&gt;cb.on_wrote = NULL;</div>
<div class="line"><span class="lineno">  623</span>  p-&gt;cb.on_wrote_arg = NULL;</div>
<div class="line"><span class="lineno">  624</span>  p-&gt;cb.on_closed = NULL;</div>
<div class="line"><span class="lineno">  625</span>  p-&gt;cb.on_closed_arg = NULL;</div>
<div class="line"><span class="lineno">  626</span>  p-&gt;cb.on_error = NULL;</div>
<div class="line"><span class="lineno">  627</span>  p-&gt;cb.on_error_arg = NULL;</div>
<div class="line"><span class="lineno">  628</span>  p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a2742eddc30d4e4409b9f1a98cf7eb054">next</a> = 0;</div>
<div class="line"><span class="lineno">  629</span>  <span class="comment">// Inicializar efds</span></div>
<div class="line"><span class="lineno">  630</span>  p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a> = (<span class="keywordtype">int</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>);</div>
<div class="line"><span class="lineno">  631</span>  <span class="keywordflow">if</span> (!p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>) {</div>
<div class="line"><span class="lineno">  632</span>    free(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad3305571e32bbb72bc95caefbb68b030">m_rings</a>);</div>
<div class="line"><span class="lineno">  633</span>    free(p);</div>
<div class="line"><span class="lineno">  634</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  635</span>  }</div>
<div class="line"><span class="lineno">  636</span>  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>; ++i) {</div>
<div class="line"><span class="lineno">  637</span>    p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>[i] = eventfd(0, EFD_NONBLOCK);</div>
<div class="line"><span class="lineno">  638</span>    <span class="keywordflow">if</span> (p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>[i] == ERROR_CODE) {</div>
<div class="line"><span class="lineno">  639</span>      <span class="keywordflow">for</span> (uint32_t j = 0; j &lt; i; ++j) {</div>
<div class="line"><span class="lineno">  640</span>        close(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>[j]);</div>
<div class="line"><span class="lineno">  641</span>      }</div>
<div class="line"><span class="lineno">  642</span>      free(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>);</div>
<div class="line"><span class="lineno">  643</span>      free(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad3305571e32bbb72bc95caefbb68b030">m_rings</a>);</div>
<div class="line"><span class="lineno">  644</span>      free(p);</div>
<div class="line"><span class="lineno">  645</span>      <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  646</span>    }</div>
<div class="line"><span class="lineno">  647</span>  }</div>
<div class="line"><span class="lineno">  648</span>  <span class="comment">// Inicializar rings</span></div>
<div class="line"><span class="lineno">  649</span>  p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a4858f070287e6269298089b993793830">rings</a> = (<span class="keyword">struct </span>io_uring *)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> io_uring) * p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>);</div>
<div class="line"><span class="lineno">  650</span>  <span class="keywordflow">if</span> (!p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a4858f070287e6269298089b993793830">rings</a>) {</div>
<div class="line"><span class="lineno">  651</span>    <span class="keywordflow">for</span> (uint32_t j = 0; j &lt; p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>; ++j) {</div>
<div class="line"><span class="lineno">  652</span>      close(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>[j]);</div>
<div class="line"><span class="lineno">  653</span>    }</div>
<div class="line"><span class="lineno">  654</span>    free(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>);</div>
<div class="line"><span class="lineno">  655</span>    free(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad3305571e32bbb72bc95caefbb68b030">m_rings</a>);</div>
<div class="line"><span class="lineno">  656</span>    free(p);</div>
<div class="line"><span class="lineno">  657</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  658</span>  }</div>
<div class="line"><span class="lineno">  659</span>  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>; ++i) {</div>
<div class="line"><span class="lineno">  660</span>    memset(&amp;p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a4858f070287e6269298089b993793830">rings</a>[i], 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> io_uring));</div>
<div class="line"><span class="lineno">  661</span>    ret = io_uring_queue_init(SAURION_RING_SIZE, &amp;p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a4858f070287e6269298089b993793830">rings</a>[i], 0);</div>
<div class="line"><span class="lineno">  662</span>    <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><span class="lineno">  663</span>      <span class="keywordflow">for</span> (uint32_t j = 0; j &lt; p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>; ++j) {</div>
<div class="line"><span class="lineno">  664</span>        close(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>[j]);</div>
<div class="line"><span class="lineno">  665</span>      }</div>
<div class="line"><span class="lineno">  666</span>      free(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>);</div>
<div class="line"><span class="lineno">  667</span>      free(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a4858f070287e6269298089b993793830">rings</a>);</div>
<div class="line"><span class="lineno">  668</span>      free(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad3305571e32bbb72bc95caefbb68b030">m_rings</a>);</div>
<div class="line"><span class="lineno">  669</span>      free(p);</div>
<div class="line"><span class="lineno">  670</span>      <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  671</span>    }</div>
<div class="line"><span class="lineno">  672</span>  }</div>
<div class="line"><span class="lineno">  673</span>  p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aa6d22bb06ad66a5a860fcd642b4e7905">pool</a> = <a class="code hl_function" href="../../d8/ddb/cthreadpool_8cpp.html#a7050a8290c4fd93b7091f84097f4c1c0">ThreadPool_create</a>(p-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>);</div>
<div class="line"><span class="lineno">  674</span>  <span class="keywordflow">return</span> p;</div>
<div class="line"><span class="lineno">  675</span>}</div>
<div class="ttc" id="acthreadpool_8cpp_html_a7050a8290c4fd93b7091f84097f4c1c0"><div class="ttname"><a href="../../d8/ddb/cthreadpool_8cpp.html#a7050a8290c4fd93b7091f84097f4c1c0">ThreadPool_create</a></div><div class="ttdeci">ThreadPool * ThreadPool_create(size_t num_threads)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddb/cthreadpool_8cpp_source.html#l00003">cthreadpool.cpp:3</a></div></div>
<div class="ttc" id="alow__saurion_8h_html_a7001c0d6b3bf1fa114a0d230c6190e3d"><div class="ttname"><a href="../../d3/d68/low__saurion_8h.html#a7001c0d6b3bf1fa114a0d230c6190e3d">n_threads</a></div><div class="ttdeci">uint32_t n_threads</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00010">low_saurion.h:10</a></div></div>
<div class="ttc" id="astructsaurion_html_a08e1b7aa083a0d311658ff7072ae7a46"><div class="ttname"><a href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">saurion::efds</a></div><div class="ttdeci">int * efds</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00142">low_saurion.h:142</a></div></div>
<div class="ttc" id="astructsaurion_html_a2742eddc30d4e4409b9f1a98cf7eb054"><div class="ttname"><a href="../../df/d32/structsaurion.html#a2742eddc30d4e4409b9f1a98cf7eb054">saurion::next</a></div><div class="ttdeci">uint32_t next</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00149">low_saurion.h:149</a></div></div>
<div class="ttc" id="astructsaurion_html_a342abf92b861ebc82e50349fe31246e2"><div class="ttname"><a href="../../df/d32/structsaurion.html#a342abf92b861ebc82e50349fe31246e2">saurion::status</a></div><div class="ttdeci">int status</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00146">low_saurion.h:146</a></div></div>
<div class="ttc" id="astructsaurion_html_a4858f070287e6269298089b993793830"><div class="ttname"><a href="../../df/d32/structsaurion.html#a4858f070287e6269298089b993793830">saurion::rings</a></div><div class="ttdeci">struct io_uring * rings</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00138">low_saurion.h:138</a></div></div>
<div class="ttc" id="astructsaurion_html_a63c38a9dc703180b628935d72236318f"><div class="ttname"><a href="../../df/d32/structsaurion.html#a63c38a9dc703180b628935d72236318f">saurion::list</a></div><div class="ttdeci">struct Node * list</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00143">low_saurion.h:143</a></div></div>
<div class="ttc" id="astructsaurion_html_aa6d22bb06ad66a5a860fcd642b4e7905"><div class="ttname"><a href="../../df/d32/structsaurion.html#aa6d22bb06ad66a5a860fcd642b4e7905">saurion::pool</a></div><div class="ttdeci">ThreadPool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00147">low_saurion.h:147</a></div></div>
<div class="ttc" id="astructsaurion_html_ad05334ffef73d89577b3bc60ecc11283"><div class="ttname"><a href="../../df/d32/structsaurion.html#ad05334ffef73d89577b3bc60ecc11283">saurion::status_m</a></div><div class="ttdeci">pthread_mutex_t status_m</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00144">low_saurion.h:144</a></div></div>
<div class="ttc" id="astructsaurion_html_ad3305571e32bbb72bc95caefbb68b030"><div class="ttname"><a href="../../df/d32/structsaurion.html#ad3305571e32bbb72bc95caefbb68b030">saurion::m_rings</a></div><div class="ttdeci">pthread_mutex_t * m_rings</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00140">low_saurion.h:140</a></div></div>
<div class="ttc" id="astructsaurion_html_add5f25d5f709bda89fa5461eecdc2b2e"><div class="ttname"><a href="../../df/d32/structsaurion.html#add5f25d5f709bda89fa5461eecdc2b2e">saurion::status_c</a></div><div class="ttdeci">pthread_cond_t status_c</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00145">low_saurion.h:145</a></div></div>
<div class="ttc" id="astructsaurion_html_ae85c8eed456efd00dcc93d005b0ad99c"><div class="ttname"><a href="../../df/d32/structsaurion.html#ae85c8eed456efd00dcc93d005b0ad99c">saurion::ss</a></div><div class="ttdeci">int ss</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00141">low_saurion.h:141</a></div></div>
<div class="ttc" id="astructsaurion_html_aee308efd9e70f3b38da24483a3f74413"><div class="ttname"><a href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">saurion::n_threads</a></div><div class="ttdeci">uint32_t n_threads</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00148">low_saurion.h:148</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga7893ccf90a98845d5d95ffda0260d0b8" name="ga7893ccf90a98845d5d95ffda0260d0b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7893ccf90a98845d5d95ffda0260d0b8">&#9670;&nbsp;</a></span>saurion_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void saurion_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d32/structsaurion.html">saurion</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroys the <code>saurion</code> structure and frees all associated resources. </p>
<p >This function waits for the event processing to stop, frees the memory used by the <code>saurion</code> structure, and closes any open file descriptors. It ensures that no resources are leaked when the structure is no longer needed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Pointer to the <code>saurion</code> structure. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00832">832</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  832</span>                                              {</div>
<div class="line"><span class="lineno">  833</span>  pthread_mutex_lock(&amp;s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad05334ffef73d89577b3bc60ecc11283">status_m</a>);</div>
<div class="line"><span class="lineno">  834</span>  <span class="keywordflow">while</span> (s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a342abf92b861ebc82e50349fe31246e2">status</a> == 1) {</div>
<div class="line"><span class="lineno">  835</span>    pthread_cond_wait(&amp;s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#add5f25d5f709bda89fa5461eecdc2b2e">status_c</a>, &amp;s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad05334ffef73d89577b3bc60ecc11283">status_m</a>);</div>
<div class="line"><span class="lineno">  836</span>  }</div>
<div class="line"><span class="lineno">  837</span>  pthread_mutex_unlock(&amp;s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad05334ffef73d89577b3bc60ecc11283">status_m</a>);</div>
<div class="line"><span class="lineno">  838</span>  <a class="code hl_function" href="../../d8/ddb/cthreadpool_8cpp.html#af203df90cae013853d5dde106517ae1d">ThreadPool_destroy</a>(s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aa6d22bb06ad66a5a860fcd642b4e7905">pool</a>);</div>
<div class="line"><span class="lineno">  839</span>  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>; ++i) {</div>
<div class="line"><span class="lineno">  840</span>    io_uring_queue_exit(&amp;s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a4858f070287e6269298089b993793830">rings</a>[i]);</div>
<div class="line"><span class="lineno">  841</span>    pthread_mutex_destroy(&amp;s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad3305571e32bbb72bc95caefbb68b030">m_rings</a>[i]);</div>
<div class="line"><span class="lineno">  842</span>  }</div>
<div class="line"><span class="lineno">  843</span>  free(s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad3305571e32bbb72bc95caefbb68b030">m_rings</a>);</div>
<div class="line"><span class="lineno">  844</span>  <a class="code hl_function" href="../../d3/d32/linked__list_8c.html#ac33c30e895caddc11181b50eca0ab735">list_free</a>(&amp;s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a63c38a9dc703180b628935d72236318f">list</a>);</div>
<div class="line"><span class="lineno">  845</span>  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>; ++i) {</div>
<div class="line"><span class="lineno">  846</span>    close(s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>[i]);</div>
<div class="line"><span class="lineno">  847</span>  }</div>
<div class="line"><span class="lineno">  848</span>  free(s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>);</div>
<div class="line"><span class="lineno">  849</span>  <span class="keywordflow">if</span> (!s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ae85c8eed456efd00dcc93d005b0ad99c">ss</a>) {</div>
<div class="line"><span class="lineno">  850</span>    close(s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ae85c8eed456efd00dcc93d005b0ad99c">ss</a>);</div>
<div class="line"><span class="lineno">  851</span>  }</div>
<div class="line"><span class="lineno">  852</span>  free(s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a4858f070287e6269298089b993793830">rings</a>);</div>
<div class="line"><span class="lineno">  853</span>  pthread_mutex_destroy(&amp;s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#ad05334ffef73d89577b3bc60ecc11283">status_m</a>);</div>
<div class="line"><span class="lineno">  854</span>  pthread_cond_destroy(&amp;s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#add5f25d5f709bda89fa5461eecdc2b2e">status_c</a>);</div>
<div class="line"><span class="lineno">  855</span>  free(s);</div>
<div class="line"><span class="lineno">  856</span>}</div>
<div class="ttc" id="acthreadpool_8cpp_html_af203df90cae013853d5dde106517ae1d"><div class="ttname"><a href="../../d8/ddb/cthreadpool_8cpp.html#af203df90cae013853d5dde106517ae1d">ThreadPool_destroy</a></div><div class="ttdeci">void ThreadPool_destroy(ThreadPool *thp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddb/cthreadpool_8cpp_source.html#l00023">cthreadpool.cpp:23</a></div></div>
<div class="ttc" id="alinked__list_8c_html_ac33c30e895caddc11181b50eca0ab735"><div class="ttname"><a href="../../d3/d32/linked__list_8c.html#ac33c30e895caddc11181b50eca0ab735">list_free</a></div><div class="ttdeci">void list_free(struct Node **head)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d32/linked__list_8c_source.html#l00124">linked_list.c:124</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gadd63cf225e55bcf4cd22ddcbd9d1c9b7" name="gadd63cf225e55bcf4cd22ddcbd9d1c9b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadd63cf225e55bcf4cd22ddcbd9d1c9b7">&#9670;&nbsp;</a></span>saurion_send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void saurion_send </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d32/structsaurion.html">saurion</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a message through a socket using io_uring. </p>
<p >This function prepares and sends a message through the specified socket using the io_uring event queue. The message is split into iovec structures for efficient transmission and sent asynchronously.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Pointer to the <code>saurion</code> structure. </td></tr>
    <tr><td class="paramname">fd</td><td>File descriptor of the socket to which the message will be sent. </td></tr>
    <tr><td class="paramname">msg</td><td>Pointer to the character string (message) to be sent. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00858">858</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  858</span>                                                                                {</div>
<div class="line"><span class="lineno">  859</span>  <a class="code hl_function" href="../../de/d27/low__saurion_8c.html#a39042ff39576b4db8db514acd6e9a224">add_write</a>(s, fd, msg, <a class="code hl_function" href="../../de/d27/low__saurion_8c.html#a7919e576d3fdccbefb75bee92abd5cc3">next</a>(s));</div>
<div class="line"><span class="lineno">  860</span>}</div>
<div class="ttc" id="alow__saurion_8c_html_a39042ff39576b4db8db514acd6e9a224"><div class="ttname"><a href="../../de/d27/low__saurion_8c.html#a39042ff39576b4db8db514acd6e9a224">add_write</a></div><div class="ttdeci">static void add_write(struct saurion *const s, int fd, const char *const str, const int sel)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00310">low_saurion.c:310</a></div></div>
<div class="ttc" id="alow__saurion_8c_html_a7919e576d3fdccbefb75bee92abd5cc3"><div class="ttname"><a href="../../de/d27/low__saurion_8c.html#a7919e576d3fdccbefb75bee92abd5cc3">next</a></div><div class="ttdeci">static uint32_t next(struct saurion *s)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00036">low_saurion.c:36</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gaeeab8302b41112175566881a1b7bf905" name="gaeeab8302b41112175566881a1b7bf905"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaeeab8302b41112175566881a1b7bf905">&#9670;&nbsp;</a></span>saurion_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int saurion_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d32/structsaurion.html">saurion</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Starts event processing in the <code>saurion</code> structure. </p>
<p >This function begins accepting socket connections and handling io_uring events in a loop. It will run continuously until a stop signal is received, allowing the application to manage multiple socket events asynchronously.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Pointer to the <code>saurion</code> structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on success, or 1 if an error occurs. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00808">808</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  808</span>                                           {</div>
<div class="line"><span class="lineno">  809</span>  pthread_mutex_init(&amp;<a class="code hl_variable" href="../../de/d27/low__saurion_8c.html#adcba6f6935d1807493e731cc5e79a661">print_mutex</a>, NULL);</div>
<div class="line"><span class="lineno">  810</span>  <a class="code hl_function" href="../../d8/ddb/cthreadpool_8cpp.html#a167313573a42e919a34b17a9cf533678">ThreadPool_init</a>(s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aa6d22bb06ad66a5a860fcd642b4e7905">pool</a>);</div>
<div class="line"><span class="lineno">  811</span>  <a class="code hl_function" href="../../d8/ddb/cthreadpool_8cpp.html#a29da21779e6052eb5dea1707ef6e8fa8">ThreadPool_add_default</a>(s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aa6d22bb06ad66a5a860fcd642b4e7905">pool</a>, <a class="code hl_function" href="../../de/d27/low__saurion_8c.html#a30bb7d15272a20fb689bf9fada1737fa">saurion_worker_master</a>, s);</div>
<div class="line"><span class="lineno">  812</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../df/df5/structsaurion__wrapper.html">saurion_wrapper</a> *<a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a9a57016e056d7d2ce6d2417340c4429e">ss</a> = NULL;</div>
<div class="line"><span class="lineno">  813</span>  <span class="keywordflow">for</span> (uint32_t i = 1; i &lt; <a class="code hl_variable" href="../../df/df5/structsaurion__wrapper.html#a56c88c88fc583f95d6f144ee3414458d">s</a>-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>; ++i) {</div>
<div class="line"><span class="lineno">  814</span>    <a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a9a57016e056d7d2ce6d2417340c4429e">ss</a> = (<span class="keyword">struct </span><a class="code hl_struct" href="../../df/df5/structsaurion__wrapper.html">saurion_wrapper</a> *)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="../../df/df5/structsaurion__wrapper.html">saurion_wrapper</a>));</div>
<div class="line"><span class="lineno">  815</span>    <a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a9a57016e056d7d2ce6d2417340c4429e">ss</a>-&gt;s = <a class="code hl_variable" href="../../df/df5/structsaurion__wrapper.html#a56c88c88fc583f95d6f144ee3414458d">s</a>;</div>
<div class="line"><span class="lineno">  816</span>    <a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a9a57016e056d7d2ce6d2417340c4429e">ss</a>-&gt;sel = i;</div>
<div class="line"><span class="lineno">  817</span>    <a class="code hl_function" href="../../d8/ddb/cthreadpool_8cpp.html#a29da21779e6052eb5dea1707ef6e8fa8">ThreadPool_add_default</a>(<a class="code hl_variable" href="../../df/df5/structsaurion__wrapper.html#a56c88c88fc583f95d6f144ee3414458d">s</a>-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aa6d22bb06ad66a5a860fcd642b4e7905">pool</a>, <a class="code hl_function" href="../../de/d27/low__saurion_8c.html#a70abc87ee43c0e1b7059ec16e975afca">saurion_worker_slave</a>, <a class="code hl_variable" href="../../d3/d68/low__saurion_8h.html#a9a57016e056d7d2ce6d2417340c4429e">ss</a>);</div>
<div class="line"><span class="lineno">  818</span>  }</div>
<div class="line"><span class="lineno">  819</span>  <span class="keywordflow">return</span> SUCCESS_CODE;</div>
<div class="line"><span class="lineno">  820</span>}</div>
<div class="ttc" id="acthreadpool_8cpp_html_a167313573a42e919a34b17a9cf533678"><div class="ttname"><a href="../../d8/ddb/cthreadpool_8cpp.html#a167313573a42e919a34b17a9cf533678">ThreadPool_init</a></div><div class="ttdeci">void ThreadPool_init(ThreadPool *thp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddb/cthreadpool_8cpp_source.html#l00007">cthreadpool.cpp:7</a></div></div>
<div class="ttc" id="acthreadpool_8cpp_html_a29da21779e6052eb5dea1707ef6e8fa8"><div class="ttname"><a href="../../d8/ddb/cthreadpool_8cpp.html#a29da21779e6052eb5dea1707ef6e8fa8">ThreadPool_add_default</a></div><div class="ttdeci">void ThreadPool_add_default(ThreadPool *thp, void(*nfn)(void *), void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddb/cthreadpool_8cpp_source.html#l00013">cthreadpool.cpp:13</a></div></div>
<div class="ttc" id="alow__saurion_8c_html_a30bb7d15272a20fb689bf9fada1737fa"><div class="ttname"><a href="../../de/d27/low__saurion_8c.html#a30bb7d15272a20fb689bf9fada1737fa">saurion_worker_master</a></div><div class="ttdeci">void saurion_worker_master(void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00677">low_saurion.c:677</a></div></div>
<div class="ttc" id="alow__saurion_8c_html_a70abc87ee43c0e1b7059ec16e975afca"><div class="ttname"><a href="../../de/d27/low__saurion_8c.html#a70abc87ee43c0e1b7059ec16e975afca">saurion_worker_slave</a></div><div class="ttdeci">void saurion_worker_slave(void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00745">low_saurion.c:745</a></div></div>
<div class="ttc" id="alow__saurion_8c_html_adcba6f6935d1807493e731cc5e79a661"><div class="ttname"><a href="../../de/d27/low__saurion_8c.html#adcba6f6935d1807493e731cc5e79a661">print_mutex</a></div><div class="ttdeci">pthread_mutex_t print_mutex</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00029">low_saurion.c:29</a></div></div>
<div class="ttc" id="alow__saurion_8h_html_a9a57016e056d7d2ce6d2417340c4429e"><div class="ttname"><a href="../../d3/d68/low__saurion_8h.html#a9a57016e056d7d2ce6d2417340c4429e">ss</a></div><div class="ttdeci">int ss</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d68/low__saurion_8h_source.html#l00003">low_saurion.h:3</a></div></div>
<div class="ttc" id="astructsaurion__wrapper_html"><div class="ttname"><a href="../../df/df5/structsaurion__wrapper.html">saurion_wrapper</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00031">low_saurion.c:31</a></div></div>
<div class="ttc" id="astructsaurion__wrapper_html_a56c88c88fc583f95d6f144ee3414458d"><div class="ttname"><a href="../../df/df5/structsaurion__wrapper.html#a56c88c88fc583f95d6f144ee3414458d">saurion_wrapper::s</a></div><div class="ttdeci">struct saurion * s</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00032">low_saurion.c:32</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ga9f32b41ec23178c2a693fec057b96532" name="ga9f32b41ec23178c2a693fec057b96532"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9f32b41ec23178c2a693fec057b96532">&#9670;&nbsp;</a></span>saurion_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void saurion_stop </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../df/d32/structsaurion.html">saurion</a> *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stops event processing in the <code>saurion</code> structure. </p>
<p >This function sends a signal to the eventfd, indicating that the event loop should stop. It gracefully shuts down the processing of any remaining events before exiting.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Pointer to the <code>saurion</code> structure. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00822">822</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  822</span>                                                 {</div>
<div class="line"><span class="lineno">  823</span>  uint64_t u = 1;</div>
<div class="line"><span class="lineno">  824</span>  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aee308efd9e70f3b38da24483a3f74413">n_threads</a>; ++i) {</div>
<div class="line"><span class="lineno">  825</span>    <span class="keywordflow">while</span> (write(s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#a08e1b7aa083a0d311658ff7072ae7a46">efds</a>[i], &amp;u, <span class="keyword">sizeof</span>(u)) &lt; 0) {</div>
<div class="line"><span class="lineno">  826</span>      usleep(TIMEOUT_RETRY);</div>
<div class="line"><span class="lineno">  827</span>    }</div>
<div class="line"><span class="lineno">  828</span>  }</div>
<div class="line"><span class="lineno">  829</span>  <a class="code hl_function" href="../../d8/ddb/cthreadpool_8cpp.html#a69d71a6f02edfe47deb07aedf33c9d90">ThreadPool_wait_empty</a>(s-&gt;<a class="code hl_variable" href="../../df/d32/structsaurion.html#aa6d22bb06ad66a5a860fcd642b4e7905">pool</a>);</div>
<div class="line"><span class="lineno">  830</span>}</div>
<div class="ttc" id="acthreadpool_8cpp_html_a69d71a6f02edfe47deb07aedf33c9d90"><div class="ttname"><a href="../../d8/ddb/cthreadpool_8cpp.html#a69d71a6f02edfe47deb07aedf33c9d90">ThreadPool_wait_empty</a></div><div class="ttdeci">void ThreadPool_wait_empty(ThreadPool *thp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddb/cthreadpool_8cpp_source.html#l00021">cthreadpool.cpp:21</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="gaddb696f3c38e160dde5a5de6e6e10f70" name="gaddb696f3c38e160dde5a5de6e6e10f70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaddb696f3c38e160dde5a5de6e6e10f70">&#9670;&nbsp;</a></span>set_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int set_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/d20/structrequest.html">request</a> **&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d8/d49/structNode.html">Node</a> **&#160;</td>
          <td class="paramname"><em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>h</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets up a request and allocates iovec structures for data handling in liburing. </p>
<p >This function configures a request structure that will be used to send or receive data through liburing's submission queues. It allocates the necessary iovec structures to split the data into manageable chunks, and optionally adds a header if specified. The request is inserted into a list tracking active requests for proper memory management and deallocation upon completion.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>Pointer to a pointer to the request structure. If NULL, a new request is created. </td></tr>
    <tr><td class="paramname">l</td><td>Pointer to the list of active requests (<a class="el" href="../../d8/d49/structNode.html">Node</a> list) where the request will be inserted. </td></tr>
    <tr><td class="paramname">s</td><td>Size of the data to be handled. Adjusted if the header flag (h) is true. </td></tr>
    <tr><td class="paramname">m</td><td>Pointer to the memory block containing the data to be processed. </td></tr>
    <tr><td class="paramname">h</td><td>Header flag. If true, a header (sizeof(uint64_t) + 1) is added to the iovec data.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns SUCCESS_CODE on success, or ERROR_CODE on failure (memory allocation issues or insertion failure). </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">SUCCESS_CODE</td><td>The request was successfully set up and inserted into the list. </td></tr>
    <tr><td class="paramname">ERROR_CODE</td><td>Memory allocation failed, or there was an error inserting the request into the list.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The function handles memory allocation for the request and iovec structures, and ensures that the memory is freed properly if an error occurs. Pointers to the iovec blocks (children_ptr) are managed and used for proper memory deallocation. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../de/d27/low__saurion_8c_source.html#l00131">131</a> of file <a class="el" href="../../de/d27/low__saurion_8c_source.html">low_saurion.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  131</span>                                                                                         {</div>
<div class="line"><span class="lineno">  132</span>  uint64_t full_size = s;</div>
<div class="line"><span class="lineno">  133</span>  <span class="keywordflow">if</span> (h) {</div>
<div class="line"><span class="lineno">  134</span>    full_size += (<span class="keyword">sizeof</span>(uint64_t) + 1);</div>
<div class="line"><span class="lineno">  135</span>  }</div>
<div class="line"><span class="lineno">  136</span>  <span class="keywordtype">size_t</span> amount = full_size / CHUNK_SZ;</div>
<div class="line"><span class="lineno">  137</span>  amount = amount + (full_size % CHUNK_SZ == 0 ? 0 : 1);</div>
<div class="line"><span class="lineno">  138</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../dc/d20/structrequest.html">request</a> *temp =</div>
<div class="line"><span class="lineno">  139</span>      (<span class="keyword">struct </span><a class="code hl_struct" href="../../dc/d20/structrequest.html">request</a> *)malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code hl_struct" href="../../dc/d20/structrequest.html">request</a>) + <span class="keyword">sizeof</span>(<span class="keyword">struct </span>iovec) * amount);</div>
<div class="line"><span class="lineno">  140</span>  <span class="keywordflow">if</span> (!temp) {</div>
<div class="line"><span class="lineno">  141</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  142</span>  }</div>
<div class="line"><span class="lineno">  143</span>  <span class="keywordflow">if</span> (!*r) {</div>
<div class="line"><span class="lineno">  144</span>    *r = temp;</div>
<div class="line"><span class="lineno">  145</span>    (*r)-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a> = NULL;</div>
<div class="line"><span class="lineno">  146</span>    (*r)-&gt;prev_size = 0;</div>
<div class="line"><span class="lineno">  147</span>    (*r)-&gt;prev_remain = 0;</div>
<div class="line"><span class="lineno">  148</span>    (*r)-&gt;next_iov = 0;</div>
<div class="line"><span class="lineno">  149</span>    (*r)-&gt;next_offset = 0;</div>
<div class="line"><span class="lineno">  150</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  151</span>    temp-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a34dcdf74ea1d647ba95bcdd78c95c3b7">client_socket</a> = (*r)-&gt;client_socket;</div>
<div class="line"><span class="lineno">  152</span>    temp-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a9cba15f1748716ffe6869a271c1ccc4d">event_type</a> = (*r)-&gt;event_type;</div>
<div class="line"><span class="lineno">  153</span>    temp-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ab8f409ae411cecc817a691455830f700">prev</a> = (*r)-&gt;prev;</div>
<div class="line"><span class="lineno">  154</span>    temp-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a02dc8e759c5216e1b7f7c908a0e0481f">prev_size</a> = (*r)-&gt;prev_size;</div>
<div class="line"><span class="lineno">  155</span>    temp-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#acb69c014fb67502b59cd112d3758569f">prev_remain</a> = (*r)-&gt;prev_remain;</div>
<div class="line"><span class="lineno">  156</span>    temp-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a4aba582d3fcf1110aa8f272d5b038a3d">next_iov</a> = (*r)-&gt;next_iov;</div>
<div class="line"><span class="lineno">  157</span>    temp-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a03abde14b48986b40d827b22e4ddfb2d">next_offset</a> = (*r)-&gt;next_offset;</div>
<div class="line"><span class="lineno">  158</span>    *r = temp;</div>
<div class="line"><span class="lineno">  159</span>  }</div>
<div class="line"><span class="lineno">  160</span>  <span class="keyword">struct </span><a class="code hl_struct" href="../../dc/d20/structrequest.html">request</a> *req = *r;</div>
<div class="line"><span class="lineno">  161</span>  req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#a1291bf32fbcafa3bb4b348578db09a9f">iovec_count</a> = (int)amount;</div>
<div class="line"><span class="lineno">  162</span>  <span class="keywordtype">void</span> **children_ptr = (<span class="keywordtype">void</span> **)malloc(amount * <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));</div>
<div class="line"><span class="lineno">  163</span>  <span class="keywordflow">if</span> (!children_ptr) {</div>
<div class="line"><span class="lineno">  164</span>    <a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#ga0f9760bc800b946244ccf790081e6bb3">free_request</a>(req, children_ptr, 0);</div>
<div class="line"><span class="lineno">  165</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  166</span>  }</div>
<div class="line"><span class="lineno">  167</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; amount; ++i) {</div>
<div class="line"><span class="lineno">  168</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#ga1c329b9155a9159b696b60247c9b328b">allocate_iovec</a>(&amp;req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[i], amount, i, full_size, children_ptr)) {</div>
<div class="line"><span class="lineno">  169</span>      <a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#ga0f9760bc800b946244ccf790081e6bb3">free_request</a>(req, children_ptr, amount);</div>
<div class="line"><span class="lineno">  170</span>      <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  171</span>    }</div>
<div class="line"><span class="lineno">  172</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#gae64e81c0ce5f52d51684d8f1129e6076">initialize_iovec</a>(&amp;req-&gt;<a class="code hl_variable" href="../../dc/d20/structrequest.html#ae23ac64f6ae30671afc753260ef411fd">iov</a>[i], amount, i, m, s, h)) {</div>
<div class="line"><span class="lineno">  173</span>      <a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#ga0f9760bc800b946244ccf790081e6bb3">free_request</a>(req, children_ptr, amount);</div>
<div class="line"><span class="lineno">  174</span>      <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  175</span>    }</div>
<div class="line"><span class="lineno">  176</span>  }</div>
<div class="line"><span class="lineno">  177</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d3/d32/linked__list_8c.html#aee07283e23385804a1d3f880cd99731e">list_insert</a>(l, req, amount, children_ptr)) {</div>
<div class="line"><span class="lineno">  178</span>    <a class="code hl_function" href="../../d9/da3/group__LowSaurion.html#ga0f9760bc800b946244ccf790081e6bb3">free_request</a>(req, children_ptr, amount);</div>
<div class="line"><span class="lineno">  179</span>    <span class="keywordflow">return</span> ERROR_CODE;</div>
<div class="line"><span class="lineno">  180</span>  }</div>
<div class="line"><span class="lineno">  181</span>  free(children_ptr);</div>
<div class="line"><span class="lineno">  182</span>  <span class="keywordflow">return</span> SUCCESS_CODE;</div>
<div class="line"><span class="lineno">  183</span>}</div>
<div class="ttc" id="agroup__LowSaurion_html_ga0f9760bc800b946244ccf790081e6bb3"><div class="ttname"><a href="../../d9/da3/group__LowSaurion.html#ga0f9760bc800b946244ccf790081e6bb3">free_request</a></div><div class="ttdeci">void free_request(struct request *req, void **children_ptr, size_t amount)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00061">low_saurion.c:61</a></div></div>
<div class="ttc" id="agroup__LowSaurion_html_ga1c329b9155a9159b696b60247c9b328b"><div class="ttname"><a href="../../d9/da3/group__LowSaurion.html#ga1c329b9155a9159b696b60247c9b328b">allocate_iovec</a></div><div class="ttdeci">int allocate_iovec(struct iovec *iov, size_t amount, size_t pos, size_t size, void **chd_ptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00114">low_saurion.c:114</a></div></div>
<div class="ttc" id="agroup__LowSaurion_html_gae64e81c0ce5f52d51684d8f1129e6076"><div class="ttname"><a href="../../d9/da3/group__LowSaurion.html#gae64e81c0ce5f52d51684d8f1129e6076">initialize_iovec</a></div><div class="ttdeci">int initialize_iovec(struct iovec *iov, size_t amount, size_t pos, const void *msg, size_t size, uint8_t h)</div><div class="ttdoc">Initializes a specified iovec structure with a message fragment.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00077">low_saurion.c:77</a></div></div>
<div class="ttc" id="alinked__list_8c_html_aee07283e23385804a1d3f880cd99731e"><div class="ttname"><a href="../../d3/d32/linked__list_8c.html#aee07283e23385804a1d3f880cd99731e">list_insert</a></div><div class="ttdeci">int list_insert(struct Node **head, void *ptr, size_t amount, void **children)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d32/linked__list_8c_source.html#l00059">linked_list.c:59</a></div></div>
<div class="ttc" id="astructrequest_html"><div class="ttname"><a href="../../dc/d20/structrequest.html">request</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00015">low_saurion.c:15</a></div></div>
<div class="ttc" id="astructrequest_html_a34dcdf74ea1d647ba95bcdd78c95c3b7"><div class="ttname"><a href="../../dc/d20/structrequest.html#a34dcdf74ea1d647ba95bcdd78c95c3b7">request::client_socket</a></div><div class="ttdeci">int client_socket</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00023">low_saurion.c:23</a></div></div>
<div class="ttc" id="astructrequest_html_a9cba15f1748716ffe6869a271c1ccc4d"><div class="ttname"><a href="../../dc/d20/structrequest.html#a9cba15f1748716ffe6869a271c1ccc4d">request::event_type</a></div><div class="ttdeci">int event_type</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d27/low__saurion_8c_source.html#l00021">low_saurion.c:21</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
